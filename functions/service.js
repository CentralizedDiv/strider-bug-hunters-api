!function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=27)}({0:function(t,e,n){"use strict";n.d(e,"c",function(){return i}),n.d(e,"a",function(){return o}),n.d(e,"b",function(){return a}),n.d(e,"d",function(){return s});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function s(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}},1:function(t,e,n){"use strict";n.d(e,"a",function(){return p}),n.d(e,"b",function(){return y}),n.d(e,"c",function(){return g}),n.d(e,"d",function(){return o}),n.d(e,"e",function(){return a}),n.d(e,"f",function(){return s}),n.d(e,"g",function(){return c}),n.d(e,"h",function(){return u}),n.d(e,"i",function(){return h});var r=n(0),i=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e};
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function o(t){return a(void 0,t)}function a(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=a(t[n],e[n]));return t}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}}}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function u(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}function c(){return"object"==typeof self&&self.self===self}function h(){return"object"==typeof navigator&&"ReactNative"===navigator.product}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var l="FirebaseError",f=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=l,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,p.prototype.create),i}return Object(r.c)(e,t),e}(Error),p=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?d(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new f(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},t}();function d(t,e){return t.replace(m,function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"})}var m=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function y(t,e){return Object.prototype.hasOwnProperty.call(t,e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=h^u&(c^h),a=1518500249):(o=u^c^h,a=1859775393):r<60?(o=u&c|h&(u|c),a=2400959708):(o=u^c^h,a=3395469782);i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295;l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t}}();function g(t,e){var n=new v(t,e);return n.subscribe.bind(n)}var v=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=b),void 0===r.error&&(r.error=b),void 0===r.complete&&(r.complete=b);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function b(){}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */},2:function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"b",function(){return s});
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var r,i=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(r||(r={}));var o=r.INFO,a=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(e<t.logLevel)){var o=(new Date).toISOString();switch(e){case r.DEBUG:case r.VERBOSE:console.log.apply(console,["["+o+"]  "+t.name+":"].concat(n));break;case r.INFO:console.info.apply(console,["["+o+"]  "+t.name+":"].concat(n));break;case r.WARN:console.warn.apply(console,["["+o+"]  "+t.name+":"].concat(n));break;case r.ERROR:console.error.apply(console,["["+o+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},s=function(){function t(t){this.name=t,this._logLevel=o,this._logHandler=a,i.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in r))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,r.ERROR].concat(t))},t}()},27:function(t,e,n){var r=n(34);r.initializeApp({apiKey:"AIzaSyA2fFvZfjVLweMg_NZnnGcS03L_oSi04r0",authDomain:"strider-bug-hunters.firebaseapp.com",databaseURL:"https://strider-bug-hunters.firebaseio.com",projectId:"strider-bug-hunters",storageBucket:"strider-bug-hunters.appspot.com",messagingSenderId:"114071764524",appId:"1:114071764524:web:25cc39625ad275b1"}),n(35);const i=r.firestore(r.app());t.exports=i},34:function(t,e,n){"use strict";n.r(e);var r=n(4);
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */e.default=r.a},35:function(t,e,n){"use strict";n.r(e);var r,i=n(4),o=n(2),a=n(0),s=n(1),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},c=c||{},h=u;function l(t){return"string"==typeof t}function f(t){return"number"==typeof t}function p(t,e){t=t.split("."),e=e||h;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function d(){}function m(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function y(t){return"array"==m(t)}function g(t){var e=m(t);return"array"==e||"object"==e&&"number"==typeof t.length}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var b="closure_uid_"+(1e9*Math.random()>>>0),w=0;function E(t,e,n){return t.call.apply(t.bind,arguments)}function S(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function T(t,e,n){return(T=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?E:S).apply(null,arguments)}function I(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var C=Date.now||function(){return+new Date};function D(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function N(){this.j=this.j,this.i=this.i}N.prototype.j=!1,N.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[b]||(this[b]=++w)},N.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var A=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(l(t))return l(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},O=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=l(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function k(t){return Array.prototype.concat.apply([],arguments)}function _(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function R(t){return/^[\s\xa0]*$/.test(t)}var M,L=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function P(t,e){return-1!=t.indexOf(e)}function x(t,e){return t<e?-1:t>e?1:0}t:{var q=h.navigator;if(q){var F=q.userAgent;if(F){M=F;break t}}M=""}function V(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function B(t){var e,n={};for(e in t)n[e]=t[e];return n}var U="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<U.length;o++)n=U[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Q(t){return Q[" "](t),t}Q[" "]=d;var K,G,W=P(M,"Opera"),z=P(M,"Trident")||P(M,"MSIE"),H=P(M,"Edge"),Y=H||z,X=P(M,"Gecko")&&!(P(M.toLowerCase(),"webkit")&&!P(M,"Edge"))&&!(P(M,"Trident")||P(M,"MSIE"))&&!P(M,"Edge"),J=P(M.toLowerCase(),"webkit")&&!P(M,"Edge");function $(){var t=h.document;return t?t.documentMode:void 0}t:{var Z="",tt=(G=M,X?/rv:([^\);]+)(\)|;)/.exec(G):H?/Edge\/([\d\.]+)/.exec(G):z?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(G):J?/WebKit\/(\S+)/.exec(G):W?/(?:Version)[ \/]?(\S+)/.exec(G):void 0);if(tt&&(Z=tt?tt[1]:""),z){var et=$();if(null!=et&&et>parseFloat(Z)){K=String(et);break t}}K=Z}var nt,rt={};function it(t){return function(t,e){var n=rt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=L(String(K)).split("."),r=L(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=x(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||x(0==a[2].length,0==s[2].length)||x(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}var ot=h.document;nt=ot&&z?$()||("CSS1Compat"==ot.compatMode?parseInt(K,10):5):void 0;var at=!z||9<=Number(nt),st=z&&!it("9"),ut=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{h.addEventListener("test",d,e),h.removeEventListener("test",d,e)}catch(t){}return t}();function ct(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function ht(t,e){if(ct.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(X){t:{try{Q(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=l(t.pointerType)?t.pointerType:lt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}ct.prototype.b=function(){this.Ja=!1},D(ht,ct);var lt={2:"touch",3:"pen",4:"mouse"};ht.prototype.b=function(){ht.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,st)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var ft="closure_listenable_"+(1e6*Math.random()|0),pt=0;function dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++pt,this.X=this.Z=!1}function mt(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function yt(t){this.src=t,this.a={},this.b=0}function gt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=A(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(mt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function vt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}yt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=vt(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new dt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var bt="closure_lm_"+(1e6*Math.random()|0),wt={};function Et(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(y(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=Ot(r);return e&&e[ft]?e.Ba(n,r,v(i)?!!i.capture:!!i,o):St(e,n,r,!0,i,o)}(t,e,n,r,i);if(y(e)){for(var o=0;o<e.length;o++)Et(t,e[o],n,r,i);return null}return n=Ot(n),t&&t[ft]?t.Aa(e,n,v(r)?!!r.capture:!!r,i):St(t,e,n,!1,r,i)}function St(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i;if(a&&!at)return null;var s=Nt(t);if(s||(t[bt]=s=new yt(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=Dt,e=at?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)ut||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(It(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Tt(t){if(!f(t)&&t&&!t.X){var e=t.src;if(e&&e[ft])gt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(It(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Nt(e))?(gt(n,t),0==n.b&&(n.src=null,e[bt]=null)):mt(t)}}}function It(t){return t in wt?wt[t]:wt[t]="on"+t}function Ct(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Tt(t),n.call(r,e)}function Dt(t,e){return!!t.X||(at?Ct(t,new ht(e,this)):Ct(t,e=new ht(e||p("window.event"),this)))}function Nt(t){return(t=t[bt])instanceof yt?t:null}var At="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ot(t){return"function"==m(t)?t:(t[At]||(t[At]=function(e){return t.handleEvent(e)}),t[At])}function kt(){N.call(this),this.c=new yt(this),this.J=this,this.B=null}function _t(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&gt(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}D(kt,N),kt.prototype[ft]=!0,(r=kt.prototype).addEventListener=function(t,e,n,r){Et(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(y(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=v(i)?!!i.capture:!!i,r=Ot(r),e&&e[ft]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=vt(a=e.a[n],r,i,o))&&(mt(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):e&&(e=Nt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=vt(n,r,i,o)),(r=-1<e?n[e]:null)&&Tt(r))}(this,t,e,n,r)},r.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(l(t))t=new ct(t,n);else if(t instanceof ct)t.target=t.target||n;else{var i=t;j(t=new ct(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=_t(a,r,!0,t)&&i}if(i=_t(a=t.a=n,r,!0,t)&&i,i=_t(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=_t(a=t.a=e[o],r,!1,t)&&i;return i},r.G=function(){if(kt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)mt(n[r]);delete e.a[t],e.b--}}this.B=null},r.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},r.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Rt=h.JSON.stringify;function Mt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Lt(){this.b=this.a=null}Mt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Pt,xt=new Mt(function(){return new Ft},function(t){t.reset()});function qt(){var t=jt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Ft(){this.next=this.b=this.a=null}function Vt(t){h.setTimeout(function(){throw t},0)}function Bt(t,e){Pt||function(){var t=h.Promise.resolve(void 0);Pt=function(){t.then(Qt)}}(),Ut||(Pt(),Ut=!0),jt.add(t,e)}Lt.prototype.add=function(t,e){var n=xt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ft.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Ft.prototype.reset=function(){this.next=this.b=this.a=null};var Ut=!1,jt=new Lt;function Qt(){for(var t;t=qt();){try{t.a.call(t.b)}catch(t){Vt(t)}var e=xt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Ut=!1}function Kt(t,e){kt.call(this),this.b=t||1,this.a=e||h,this.f=T(this.gb,this),this.g=C()}function Gt(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Wt(t,e,n){if("function"==m(t))n&&(t=T(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=T(t.handleEvent,t)}return 2147483647<Number(e)?-1:h.setTimeout(t,e||0)}function zt(t,e,n){N.call(this),this.f=null!=n?T(t,n):t,this.c=e,this.b=T(this.ab,this),this.a=[]}function Ht(t){t.U=Wt(t.b,t.c),t.f.apply(null,t.a)}function Yt(t){N.call(this),this.b=t,this.a={}}D(Kt,kt),(r=Kt.prototype).ba=!1,r.L=null,r.gb=function(){if(this.ba){var t=C()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Gt(this),this.start()))}},r.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=C())},r.G=function(){Kt.N.G.call(this),Gt(this),delete this.a},D(zt,N),(r=zt.prototype).ea=!1,r.U=null,r.Ua=function(t){this.a=arguments,this.U?this.ea=!0:Ht(this)},r.G=function(){zt.N.G.call(this),this.U&&(h.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},r.ab=function(){this.U=null,this.ea&&(this.ea=!1,Ht(this))},D(Yt,N);var Xt=[];function Jt(t,e,n,r){y(n)||(n&&(Xt[0]=n.toString()),n=Xt);for(var i=0;i<n.length;i++){var o=Et(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function $t(t){V(t.a,function(t,e){this.a.hasOwnProperty(e)&&Tt(t)},t),t.a={}}function Zt(){}Yt.prototype.G=function(){Yt.N.G.call(this),$t(this)},Yt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var te=new kt;function ee(t){ct.call(this,"serverreachability",t)}function ne(t){te.dispatchEvent(new ee(te,t))}function re(t){ct.call(this,"statevent",t)}function ie(t){te.dispatchEvent(new re(te,t))}function oe(t){ct.call(this,"timingevent",t)}function ae(t,e){if("function"!=m(t))throw Error("Fn must not be null and must be a function");return h.setTimeout(function(){t()},e)}D(ee,ct),D(re,ct),D(oe,ct);var se={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},ue={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function ce(){}function he(t){var e;return(e=t.a)||(e=t.a={}),e}function le(){}ce.prototype.a=null;var fe,pe={OPEN:"a",ib:"b",Na:"c",rb:"d"};function de(){ct.call(this,"d")}function me(){ct.call(this,"c")}function ye(){}function ge(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Yt(this),this.O=ve,t=Y?125:void 0,this.P=new Kt(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}D(de,ct),D(me,ct),D(ye,ce),fe=new ye;var ve=45e3,be={},we={};function Ee(t,e,n){t.F=1,t.f=We(Ve(e)),t.l=n,t.H=!0,Te(t,null)}function Se(t,e,n,r){t.F=1,t.f=We(Ve(e)),t.l=null,t.H=n,Te(t,r)}function Te(t,e){t.v=C(),De(t),t.D=Ve(t.f),Ge(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new zt(T(t.Ka,t,t.a),t.J)),Jt(t.I,t.a,"readystatechange",t.eb),e=t.h?B(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ne(1)}function Ie(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Ce(t,n);if(i==we){4==e&&(t.c=4,ie(14),r=!1);break}if(i==be){t.c=4,ie(15),r=!1;break}_e(t,i)}4==e&&0==n.length&&(t.c=1,ie(16),r=!1),t.b=t.b&&r,r||(ke(t),Oe(t))}function Ce(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?we:(n=Number(e.substring(n,r)),isNaN(n)?be:(r+=1)+n>e.length?we:(e=e.substr(r,n),t.A=r+n,e))}function De(t){t.R=C()+t.O,Ne(t,t.O)}function Ne(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=ae(T(t.bb,t),e)}function Ae(t){t.i&&(h.clearTimeout(t.i),t.i=null)}function Oe(t){t.g.Da()||t.m||t.g.na(t)}function ke(t){Ae(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Gt(t.P),$t(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function _e(t,e){try{t.g.Ga(t,e),ne(4)}catch(t){}}function Re(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(g(t)||l(t))O(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(g(t)||l(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(l(t))return t.split("");if(g(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Me(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Me)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Le(t,e){xe(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Pe(t))}function Pe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];xe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)xe(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function xe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(r=ge.prototype).setTimeout=function(t){this.O=t},r.eb=function(t){t=t.target;var e=this.B;e&&3==Vn(t)?e.Ua():this.Ka(t)},r.Ka=function(t){try{if(t==this.a)t:{var e=Vn(this.a),n=this.a.ya(),r=this.a.T();if(!(3>e||3==e&&!Y&&!this.a.aa())){this.m||4!=e||7==n||ne(8==n||0>=r?3:2),Ae(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Bn(this.a,"X-HTTP-Initial-Response");if(a&&!R(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,ie(12),ke(this),Oe(this);break t}this.s=!0,_e(this,s)}this.H?(Ie(this,e,o),Y&&this.b&&3==e&&(Jt(this.I,this.P,"tick",this.cb),this.P.start())):_e(this,o),4==e&&ke(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,De(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ie(12)):(this.c=0,ie(13)),ke(this),Oe(this)}}}catch(t){}},r.cb=function(){if(this.a){var t=Vn(this.a),e=this.a.aa();this.A<e.length&&(Ae(this),Ie(this,t,e),this.b&&4!=t&&De(this))}},r.cancel=function(){this.m=!0,ke(this)},r.bb=function(){this.i=null;var t=C();0<=t-this.R?(2!=this.F&&(ne(3),ie(17)),ke(this),this.c=2,Oe(this)):Ne(this,this.R-t)},(r=Me.prototype).C=function(){Pe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},r.K=function(){return Pe(this),this.a.concat()},r.get=function(t,e){return xe(this.b,t)?this.b[t]:e},r.set=function(t,e){xe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},r.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var qe=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Fe(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Fe?(this.h=void 0!==e?e:t.h,Be(this,t.f),this.j=t.j,Ue(this,t.b),je(this,t.i),this.a=t.a,Qe(this,sn(t.c)),this.g=t.g):t&&(n=String(t).match(qe))?(this.h=!!e,Be(this,n[1]||"",!0),this.j=ze(n[2]||""),Ue(this,n[3]||"",!0),je(this,n[4]),this.a=ze(n[5]||"",!0),Qe(this,n[6]||"",!0),this.g=ze(n[7]||"")):(this.h=!!e,this.c=new en(null,this.h))}function Ve(t){return new Fe(t)}function Be(t,e,n){t.f=n?ze(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ue(t,e,n){t.b=n?ze(e,!0):e}function je(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Qe(t,e,n){e instanceof en?(t.c=e,function(t,e){e&&!t.f&&(nn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(rn(this,e),an(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=He(e,Ze)),t.c=new en(e,t.h))}function Ke(t,e,n){t.c.set(e,n)}function Ge(t,e,n){y(n)||(n=[String(n)]),an(t.c,e,n)}function We(t){return Ke(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^C()).toString(36)),t}function ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function He(t,e,n){return l(t)?(t=encodeURI(t).replace(e,Ye),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ye(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Fe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(He(e,Xe,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(He(e,Xe,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(He(n,"/"==n.charAt(0)?$e:Je,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",He(n,tn)),t.join("")},Fe.prototype.resolve=function(t){var e=Ve(this),n=!!t.f;n?Be(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Ue(e,t.b):n=null!=t.i;var r=t.a;if(n)je(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(P(i,"./")||P(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Qe(e,sn(t.c)):n=!!t.g,n&&(e.g=t.g),e};var Xe=/[#\/\?@]/g,Je=/[#\?:]/g,$e=/[#\?]/g,Ze=/[#\?@]/g,tn=/#/g;function en(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function nn(t){t.a||(t.a=new Me,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function rn(t,e){nn(t),e=un(t,e),xe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Le(t.a,e))}function on(t,e){return nn(t),e=un(t,e),xe(t.a.b,e)}function an(t,e,n){rn(t,e),0<n.length&&(t.c=null,t.a.set(un(t,e),_(n)),t.b+=n.length)}function sn(t){var e=new en;return e.c=t.c,t.a&&(e.a=new Me(t.a),e.b=t.b),e}function un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function cn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function hn(t){var e=t.a.F.a;if(null!=e)ie(4),e?(ie(10),$n(t.a,t,!1)):(ie(11),$n(t.a,t,!0));else{t.b=new ge(t,void 0,void 0),t.b.h=t.h,e=rr(e=t.a,e.Y()?t.f:null,t.i),ie(4),Ge(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Ke(e,n,r),Se(t.b,e,!1,t.f)}}function ln(){this.a=this.b=null}function fn(){this.a=new Me}function pn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[b]||(t[b]=++w)):e.charAt(0)+t}function dn(t,e){this.b=t,this.a=e}function mn(t){this.g=t||yn,h.PerformanceNavigationTiming?t=0<(t=h.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(h.ka&&h.ka.Ea&&h.ka.Ea()&&h.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new fn),this.b=null,this.c=[]}(r=en.prototype).add=function(t,e){nn(this),this.c=null,t=un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},r.forEach=function(t,e){nn(this),this.a.forEach(function(n,r){O(n,function(n){t.call(e,n,r,this)},this)},this)},r.K=function(){nn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},r.C=function(t){nn(this);var e=[];if(l(t))on(this,t)&&(e=k(e,this.a.get(un(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=k(e,t[n])}return e},r.set=function(t,e){return nn(this),this.c=null,on(this,t=un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},r.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},r.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},D(function(){},function(){}),(r=cn.prototype).M=null,r.$=function(t){return this.a.$(t)},r.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},r.Da=function(){return!1},r.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Bn(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Bn(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void er(e,2)}this.f=r[0]}else(e=this.a).m=this.c,er(e,2)}else 1==this.M&&(this.g?ie(6):"11111"==e?(ie(5),this.g=!0,(!z||10<=Number(nt))&&(this.c=200,this.b.cancel(),ie(11),$n(this.a,this,!0))):(ie(7),this.g=!1))},r.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,hn(this)):1==this.M&&(this.g?(ie(11),$n(this.a,this,!0)):(ie(10),$n(this.a,this,!1)));else{0==this.M?ie(8):1==this.M&&ie(9);var t=this.a;t.m=this.c,er(t,2)}},r.Y=function(){return this.a.Y()},r.ma=function(){return this.a.ma()},fn.prototype.add=function(t){this.a.set(pn(t),t)},fn.prototype.C=function(){return this.a.C()};var yn=10;function gn(t,e){!t.a&&(P(e,"spdy")||P(e,"quic")||P(e,"h2"))&&(t.f=t.g,t.a=new fn,t.b&&(En(t,t.b),t.b=null))}function vn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function bn(t){return t.b?1:t.a?t.a.a.c:0}function wn(t,e){return t.b?t=t.b==e:t.a?(e=pn(e),t=xe(t.a.a.b,e)):t=!1,t}function En(t,e){t.a?t.a.add(e):t.b=e}function Sn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=pn(e),n=xe(t.a.a.b,n)),n&&Le(t.a.a,pn(e)))}function Tn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null!=t.a&&0!=t.a.a.c){var e=t.c;return O(t.a.C(),function(t){e=e.concat(t.j)}),e}return _(t.c)}function In(){}function Cn(){this.a=new In}function Dn(t,e,n){var r=n||"";try{Re(t,function(t,n){var i=t;v(t)&&(i=Rt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Nn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}mn.prototype.cancel=function(){this.c=Tn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(O(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},In.prototype.stringify=function(t){return h.JSON.stringify(t,void 0)},In.prototype.parse=function(t){return h.JSON.parse(t,void 0)};var An=h.JSON.parse;function On(t){kt.call(this),this.headers=new Me,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=kn,this.D=this.F=!1}D(On,kt);var kn="",_n=/^https?$/i,Rn=["POST","PUT"];function Mn(t){return"content-type"==t.toLowerCase()}function Ln(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Pn(t),qn(t)}function Pn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function xn(t){if(t.b&&void 0!==c&&(!t.s[1]||4!=Vn(t)||2!=t.T()))if(t.l&&4==Vn(t))Wt(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Vn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(qe)[1]||null;if(!o&&h.self&&h.self.location){var a=h.self.location.protocol;o=a.substr(0,a.length-1)}i=!_n.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",Pn(t))}finally{qn(t)}}}function qn(t,e){if(t.a){Fn(t);var n=t.a,r=t.s[0]?d:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Fn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(h.clearTimeout(t.m),t.m=null)}function Vn(t){return t.a?t.a.readyState:0}function Bn(t,e){return t.a?t.a.getResponseHeader(e):null}function Un(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return V(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),l(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Ke(t,e,n),t}function jn(t){this.f=[],this.F=new ln,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!p("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=p("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=p("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=p("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=p("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new mn(t&&t.concurrentRequestLimit),this.ja=new Cn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Qn(t){if(Kn(t),3==t.u){var e=t.P++,n=Ve(t.B);Ke(n,"SID",t.H),Ke(n,"RID",e),Ke(n,"TYPE","terminate"),Hn(t,n),(e=new ge(t,e,void 0)).F=2,e.f=We(Ve(n)),n=!1,h.navigator&&h.navigator.sendBeacon&&(n=h.navigator.sendBeacon(e.f.toString(),"")),!n&&h.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=C(),De(e)}nr(t)}function Kn(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(h.clearTimeout(t.l),t.l=null),Zn(t),t.b.cancel(),t.h&&(f(t.h)&&h.clearTimeout(t.h),t.h=null)}function Gn(t,e){t.f.push(new dn(t.Ra++,e)),3==t.u&&Wn(t)}function Wn(t){vn(t.b)||t.h||(t.h=!0,Bt(t.Ia,t),t.A=0)}function zn(t,e){var n;n=e?e.W:t.P++;var r=Ve(t.B);Ke(r,"SID",t.H),Ke(r,"RID",n),Ke(r,"AID",t.O),Hn(t,r),t.g&&t.i&&Un(r,t.g,t.i),n=new ge(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Yn(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),En(t.b,n),Ee(n,r,e)}function Hn(t,e){t.c&&Re({},function(t,n){Ke(e,n,t)})}function Yn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?T(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),s=!1;else try{Dn(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Xn(t){t.a||t.l||(t.S=1,Bt(t.Ha,t),t.v=0)}function Jn(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=ae(T(t.Ha,t),tr(t,t.v)),t.v++,!0)}function $n(t,e,n){var r=e.l;r&&gn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=rr(t,null,t.ha),Wn(t)}function Zn(t){null!=t.s&&(h.clearTimeout(t.s),t.s=null)}function tr(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function er(t,e){if(2==e){var n=null;t.c&&(n=null);var r=T(t.fb,t);n||(n=new Fe("//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||Be(n,"https"),We(n)),function(t,e){var n=new Zt;if(h.Image){var r=new Image;r.onload=I(Nn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=I(Nn,n,r,"TestLoadImage: error",!1,e),r.onabort=I(Nn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=I(Nn,n,r,"TestLoadImage: timeout",!1,e),h.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ie(2);t.u=0,t.c&&t.c.ta(e),nr(t),Kn(t)}function nr(t){t.u=0,t.m=-1,t.c&&(0==Tn(t.b).length&&0==t.f.length||(t.b.c.length=0,_(t.f),t.f.length=0),t.c.sa())}function rr(t,e,n){var r=function(t){return t instanceof Fe?Ve(t):new Fe(t,void 0)}(n);if(""!=r.b)e&&Ue(r,e+"."+r.b),je(r,r.i);else{var i,o=h.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Fe(null,void 0);return t&&Be(i,t),e&&Ue(i,e),n&&je(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&V(t.V,function(t,e){Ke(r,e,t)}),e=t.j,n=t.I,e&&n&&Ke(r,e,n),Ke(r,"VER",t.wa),Hn(t,r),r}function ir(){}function or(){if(z&&!(10<=Number(nt)))throw Error("Environmental error: no available transport.")}function ar(t,e){kt.call(this),this.a=new jn(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!R(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!R(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new cr(this)}function sr(t){de.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function ur(){me.call(this),this.status=1}function cr(t){this.a=t}(r=On.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?he(this.H):he(fe),this.a.onreadystatechange=T(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Ln(this,t)}t=n||"";var i=new Me(this.headers);r&&Re(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Mn,n=t.length,r=l(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:l(t)?t.charAt(e):t[e]}(i.K()),n=h.FormData&&t instanceof h.FormData,!(0<=A(Rn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Fn(this),0<this.o&&((this.D=function(t){return z&&it(9)&&f(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=T(this.Ca,this)):this.m=Wt(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Ln(this,t)}},r.Ca=function(){void 0!==c&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},r.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),qn(this))},r.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),qn(this,!0)),On.N.G.call(this)},r.Fa=function(){this.j||(this.w||this.l||this.g?xn(this):this.$a())},r.$a=function(){xn(this)},r.T=function(){try{return 2<Vn(this)?this.a.status:-1}catch(t){return-1}},r.za=function(){try{return 2<Vn(this)?this.a.statusText:""}catch(t){return""}},r.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},r.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),An(e)}},r.ya=function(){return this.h},r.Ya=function(){return l(this.f)?this.f:String(this.f)},(r=jn.prototype).wa=8,r.u=1,r.Da=function(){return 0==this.u},r.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new ge(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?j(r=B(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&l(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Yn(this,n,e),Ke(i=Ve(this.B),"RID",t),Ke(i,"CVER",22),this.o&&this.j&&Ke(i,"X-HTTP-Session-Id",this.j),Hn(this,i),this.g&&r&&Un(i,this.g,r),En(this.b,n),this.W?(Ke(i,"$req",e),Ke(i,"SID","null"),n.S=!0,Ee(n,i,null)):Ee(n,i,e),this.u=2}}else 3==this.u&&(t?zn(this,t):0==this.f.length||vn(this.b)||zn(this))},r.Ha=function(){this.l=null,this.a=new ge(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ve(this.pa);Ke(t,"RID","rpc"),Ke(t,"SID",this.H),Ke(t,"CI",this.ia?"0":"1"),Ke(t,"AID",this.O),Hn(this,t),Ke(t,"TYPE","xmlhttp"),this.g&&this.i&&Un(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Se(this.a,t,!0,this.ga)},r.Ga=function(t,e){if(0!=this.u&&(this.a==t||wn(this.b,t)))if(this.m=t.o,!t.s&&wn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(y(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Zn(this),this.a.cancel(),this.a=null}Jn(this),ie(18)}}else this.ra=e[1],0<this.ra-this.O&&37500>e[2]&&this.ia&&0==this.v&&!this.s&&(this.s=ae(T(this.Za,this),6e3));if(1>=bn(this.b)&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else er(this,11)}else if((t.s||this.a==t)&&Zn(this),!R(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&f(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Bn(r,"X-Client-Wire-Protocol"))&&gn(this.b,i),this.j&&(r=Bn(r,"X-HTTP-Session-Id")))&&(this.I=r,Ke(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=rr(this,this.Y()?this.ga:null,this.ha),r.s?(Sn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Ae(r),De(r)),this.a=r):Xn(this),0<this.f.length&&Wn(this)}else"stop"!=r[0]&&"close"!=r[0]||er(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?er(this,7):Qn(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},r.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Jn(this),ie(19))},r.na=function(t){var e=null;if(this.a==t){Zn(this),this.a=null;var n=2}else{if(!wn(this.b,t))return;e=t.j,Sn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=C()-t.v,te.dispatchEvent(new oe(te,t.l?t.l.length:0,e,this.A)),Wn(this)):Xn(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(bn(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa))&&(t.h=ae(T(t.Ia,t,e),tr(t,t.A)),t.A++,!0))}(this,t)||2==n&&Jn(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:er(this,5);break;case 4:er(this,10);break;case 3:er(this,6);break;default:er(this,2)}}},r.fb=function(t){ie(t?2:1)},r.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new On(this.La)).F=this.R,t},r.ma=function(){return!!this.c&&!0},r.Y=function(){return this.R},(r=ir.prototype).va=function(){},r.ua=function(){},r.ta=function(){},r.sa=function(){},r.Ta=function(){},or.prototype.a=function(t,e){return new ar(t,e)},D(ar,kt),(r=ar.prototype).addEventListener=function(t,e,n,r){ar.N.addEventListener.call(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){ar.N.removeEventListener.call(this,t,e,n,r)},r.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;ie(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new cn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Un(e,t.g,t.i)),(t=t.w).i=n,e=rr(t.a,null,t.i),ie(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,hn(t)):(Ge(e,"MODE","init"),!t.a.o&&t.a.j&&Ge(e,"X-HTTP-Session-Id",t.a.j),t.b=new ge(t,void 0,void 0),t.b.h=t.h,Se(t.b,e,!1,null),t.M=0)},r.close=function(){Qn(this.a)},r.Xa=function(t){if(l(t)){var e={};e.__data__=t,Gn(this.a,e)}else this.h?((e={}).__data__=Rt(t),Gn(this.a,e)):Gn(this.a,t)},r.G=function(){this.a.c=null,delete this.f,Qn(this.a),delete this.a,ar.N.G.call(this)},D(sr,de),D(ur,me),D(cr,ir),cr.prototype.va=function(){this.a.dispatchEvent("a")},cr.prototype.ua=function(t){this.a.dispatchEvent(new sr(t))},cr.prototype.ta=function(t){this.a.dispatchEvent(new ur(t))},cr.prototype.sa=function(){this.a.dispatchEvent("b")};var hr=I(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},or);or.prototype.createWebChannel=or.prototype.a,ar.prototype.send=ar.prototype.Xa,ar.prototype.open=ar.prototype.Wa,ar.prototype.close=ar.prototype.close,se.NO_ERROR=0,se.TIMEOUT=8,se.HTTP_ERROR=6,ue.COMPLETE="complete",le.EventType=pe,pe.OPEN="a",pe.CLOSE="b",pe.ERROR="c",pe.MESSAGE="d",kt.prototype.listen=kt.prototype.Aa,On.prototype.listenOnce=On.prototype.Ba,On.prototype.getLastError=On.prototype.Ya,On.prototype.getLastErrorCode=On.prototype.ya,On.prototype.getStatus=On.prototype.T,On.prototype.getStatusText=On.prototype.za,On.prototype.getResponseJson=On.prototype.Va,On.prototype.getResponseText=On.prototype.aa,On.prototype.send=On.prototype.ca;var lr,fr={createWebChannelTransport:hr,ErrorCode:se,EventType:ue,WebChannel:le,XhrIo:On},pr=fr.createWebChannelTransport,dr=fr.ErrorCode,mr=fr.EventType,yr=fr.WebChannel,gr=fr.XhrIo,vr=i.a.SDK_VERSION,br=new o.b("@firebase/firestore");function wr(){return br.logLevel===o.a.DEBUG?lr.DEBUG:br.logLevel===o.a.SILENT?lr.SILENT:lr.ERROR}function Er(t){switch(t){case lr.DEBUG:br.logLevel=o.a.DEBUG;break;case lr.ERROR:br.logLevel=o.a.ERROR;break;case lr.SILENT:br.logLevel=o.a.SILENT;break;default:br.error("Firestore ("+vr+"): Invalid value passed to `setLogLevel`")}}function Sr(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(br.logLevel<=o.a.DEBUG){var i=n.map(Ir);br.debug.apply(br,["Firestore ("+vr+") ["+t+"]: "+e].concat(i))}}function Tr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(br.logLevel<=o.a.ERROR){var r=e.map(Ir);br.error.apply(br,["Firestore ("+vr+"): "+t].concat(r))}}function Ir(t){if("string"==typeof t)return t;var e=Nr.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(t){var e="FIRESTORE ("+vr+") INTERNAL ASSERTION FAILED: "+t;throw Tr(e),new Error(e)}function Dr(t,e){t||Cr(e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.DEBUG=0]="DEBUG",t[t.ERROR=1]="ERROR",t[t.SILENT=2]="SILENT"}(lr||(lr={}));var Nr=function(){function t(){}return t.setPlatform=function(e){t.platform&&Cr("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||Cr("Platform not set"),t.platform},t}();function Ar(){return Nr.getPlatform().emptyByteString}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Or={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},kr=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(a.c)(e,t),e}(Error);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _r(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new kr(Or.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Mr(t,e){return void 0!==t?t:e}function Lr(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Pr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function xr(t){for(var e in Dr(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function qr(t,e){if(0!==e.length)throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+ei(e.length,"argument")+".")}function Fr(t,e,n){if(e.length!==n)throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() requires "+ei(n,"argument")+", but was called with "+ei(e.length,"argument")+".")}function Vr(t,e,n){if(e.length<n)throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() requires at least "+ei(n,"argument")+", but was called with "+ei(e.length,"argument")+".")}function Br(t,e,n,r){if(e.length<n||e.length>r)throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+ei(e.length,"argument")+".")}function Ur(t,e,n,r){Hr(t,e,ti(n)+" argument",r)}function jr(t,e,n,r){void 0!==r&&Ur(t,e,n,r)}function Qr(t,e,n,r){Hr(t,e,n+" option",r)}function Kr(t,e,n,r){void 0!==r&&Qr(t,e,n,r)}function Gr(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Xr(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Xr(r[o]))}(t,e,n,r,i)}function Wr(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(Xr(u))}var c=Xr(r);throw new kr(Or.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function zr(t,e,n,r){if(!e.some(function(t){return t===r}))throw new kr(Or.INVALID_ARGUMENT,"Invalid value "+Xr(r)+" provided to function "+t+"() for its "+ti(n)+" argument. Acceptable values: "+e.join(", "))}function Hr(t,e,n,r){if(!("object"===e?Yr(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Xr(r);throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Yr(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Xr(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Cr("Unknown wrong type: "+typeof t)}function Jr(t,e,n){if(void 0===n)throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ti(e)+" argument, but it was undefined.")}function $r(t,e,n){Pr(e,function(e,r){if(n.indexOf(e)<0)throw new kr(Or.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function Zr(t,e,n,r){var i=Xr(r);return new kr(Or.INVALID_ARGUMENT,"Function "+t+"() requires its "+ti(n)+" argument to be a "+e+", but it was: "+i)}function ti(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function ei(t,e){return t+" "+e+(1===t?"":"s")}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ni=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Dr(20===e.length,"Invalid auto ID: "+e),e},t}();function ri(t,e){return t<e?-1:t>e?1:0}function ii(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function oi(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ai(){if("undefined"==typeof Uint8Array)throw new kr(Or.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function si(){if(!Nr.getPlatform().base64Available)throw new kr(Or.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ui,ci=function(){function t(t){si(),this._binaryString=t}return t.fromBase64String=function(e){Fr("Blob.fromBase64String",arguments,1),Ur("Blob.fromBase64String","string",1,e),si();try{var n=Nr.getPlatform().atob(e);return new t(n)}catch(t){throw new kr(Or.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(Fr("Blob.fromUint8Array",arguments,1),ai(),!(e instanceof Uint8Array))throw Zr("Blob.fromUint8Array","Uint8Array",1,e);var n=Array.prototype.map.call(e,function(t){return String.fromCharCode(t)}).join("");return new t(n)},t.prototype.toBase64=function(){return Fr("Blob.toBase64",arguments,0),si(),Nr.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){Fr("Blob.toUint8Array",arguments,0),ai();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return ri(this._binaryString,t._binaryString)},t}(),hi=_r(ci,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),li=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},fi="(default)",pi=function(){function t(t,e){this.projectId=t,this.database=e||fi}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===fi},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return ri(this.projectId,t.projectId)||ri(this.database,t.database)},t}(),di=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),mi=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Cr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Cr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,Dr(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return Dr(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return Dr(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return Dr(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),yi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(t.indexOf("//")>=0)throw new kr(Or.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return t.length>0}))},e.EMPTY_PATH=new e([]),e}(mi),gi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,vi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return gi.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new kr(Or.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new kr(Or.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new kr(Or.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?(a=!a,i++):"."!==s||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new kr(Or.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(mi),bi=function(){function t(e){this.path=e,Dr(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===yi.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return yi.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new yi(e.slice()))},t.fromPathString=function(e){return new t(yi.fromString(e))},t.EMPTY=new t(new yi([])),t}(),wi=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})};!function(t){t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh",t.LruGarbageCollection="lru_garbage_collection"}(ui||(ui={}));var Ei=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new wi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new kr(Or.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),Si=function(){function t(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueAndInitiateShutdown=function(t){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},t.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw Tr("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Dr(e>=0,"Attempted to schedule an operation with a negative delay of "+e),Dr(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=Ei.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&Cr("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){Dr(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++){if(n[e].timerId===t)return!0}return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){Dr(t===ui.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==ui.All&&i.timerId===t)break}return e.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Dr(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),Ti="",Ii="",Ci="",Di="";function Ni(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Oi(e)),e=Ai(t.get(n),e);return Oi(e)}function Ai(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Ti+Ci;break;case Ti:n+=Ti+Di;break;default:n+=o}}return n}function Oi(t){return t+Ti+Ii}function ki(t){var e=t.length;if(Dr(e>=2,"Invalid path "+t),2===e)return Dr(t.charAt(0)===Ti&&t.charAt(1)===Ii,"Non-empty path "+t+" had length 2"),yi.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Ti,o);switch((a<0||a>n)&&Cr('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Ii:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Ci:i+=t.substring(o,a),i+="\0";break;case Di:i+=t.substring(o,a+1);break;default:Cr('Invalid encoded resource path: "'+t+'"')}o=a+2}return new yi(r)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _i=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new kr(Or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new kr(Or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new kr(Or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new kr(Or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?ri(this.nanoseconds,t.nanoseconds):ri(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),Ri=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new _i(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new _i(0,0)),t}(),Mi=function(){function t(t,e){this.comparator=t,this.root=e||Pi.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Pi.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pi.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Li(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Li(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Li(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Li(this.root,t,this.comparator,!0)},t}(),Li=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){Dr(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Pi=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Cr("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Cr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Cr("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),xi=function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Cr("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Cr("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Cr("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Cr("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Cr("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Pi(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pi.EMPTY=new xi;
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var qi=function(){function t(t){this.comparator=t,this.data=new Mi(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach(function(t){n=n.add(t)}),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Fi(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Fi(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Fi=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Vi=new Mi(bi.comparator);function Bi(){return Vi}function Ui(){return Bi()}var ji=new Mi(bi.comparator);function Qi(){return ji}var Ki=new Mi(bi.comparator);function Gi(){return Ki}var Wi=new qi(bi.comparator);function zi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Wi,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Hi=new qi(ri);function Yi(){return Hi}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xi=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r,Dr(r.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&Dr(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Dr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){e&&Dr(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++){(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime))}for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},zi())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&ii(this.mutations,t.mutations)&&ii(this.baseMutations,t.baseMutations)},t}(),Ji=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){Dr(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=Gi(),a=e.mutations,s=0;s<a.length;s++)o=o.insert(a[s].key,r[s].version);return new t(e,n,r,i,o)},t}(),$i=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Cr("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++){r(o[i])}return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Zi=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r,i){return Dr(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ro(t).iterate({index:Ko.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=no(n),oo(t).put(e)})},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=no(e),oo(t).put(n)})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=io(t),a=ro(t);return a.add({}).next(function(s){Dr("number"==typeof s,"Auto-generated key is not a number");var u=new Xi(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();for(var h=[],l=0,f=r;l<f.length;l++){var p=f[l],d=Go.key(i.userId,p.key.path,s);h.push(a.put(c)),h.push(o.put(d,Go.PLACEHOLDER)),h.push(i.indexManager.addToCollectionParentIndex(t,p.key.path.popLast()))}return $i.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return ro(t).get(e).next(function(t){return t?(Dr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?$i.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ro(t).iterate({index:Ko.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Dr(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()}).next(function(){return o})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ro(t).loadAll(Ko.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Go.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return io(t).iterate({range:i},function(r,i,a){var s=r[0],u=r[1],c=r[2],h=ki(u);if(s===n.userId&&e.path.isEqual(h))return ro(t).get(c).next(function(t){if(!t)throw Cr("Dangling document-mutation reference found: "+r+" which points to "+c);Dr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});a.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new qi(ri),i=[];return e.forEach(function(e){var o=Go.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=io(t).iterate({range:a},function(t,i,o){var a=t[0],s=t[1],u=t[2],c=ki(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(s)}),$i.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;Dr(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Dr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=Go.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new qi(ri);return io(t).iterate({range:a},function(t,e,o){var a=t[0],u=t[1],c=t[2],h=ki(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,s)})},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(ro(t).get(e).next(function(t){if(null===t)throw Cr("Dangling document-mutation reference found, which points to "+e);Dr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),$i.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return eo(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),$i.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return $i.resolve();var r=IDBKeyRange.lowerBound(Go.prefixForUser(e.userId)),i=[];return io(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=ki(t[1]);i.push(o)}else r.done()}).next(function(){Dr(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},t.prototype.containsKey=function(t,e){return to(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return oo(t).get(this.userId).next(function(t){return t||new Qo(e.userId,-1,"")})},t}();function to(t,e,n){var r=Go.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return io(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],s=t[1];t[2];o===e&&s===i&&(a=!0),r.done()}).next(function(){return a})}function eo(t,e,n){var r=t.store(Ko.store),i=t.store(Go.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Dr(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Go.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return $i.waitFor(o).next(function(){return c})}function no(t){return t instanceof Uint8Array?(Dr("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function ro(t){return wa.getStore(t,Ko.store)}function io(t){return wa.getStore(t,Go.store)}function oo(t){return wa.getStore(t,Qo.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ao,so=1;!function(t){t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine"}(ao||(ao={}));var uo=function(){function t(t,e){this.generatorId=t,Dr((t&so)===t,"Generator ID "+t+" contains more than "+so+" reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=1<<so,t},t.prototype.after=function(t){return this.seek(t+(1<<so)),this.next()},t.prototype.seek=function(t){Dr((t&so)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(ao.QueryCache,2)},t.forSyncEngine=function(){return new t(ao.SyncEngine)},t}(),co="SimpleDb",ho=function(){function t(e){this.db=e,12.2===t.getIOSVersion(Object(s.f)())&&Tr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.openOrCreate=function(e,n,r){return Dr(t.isAvailable(),"IndexedDB not supported in current environment."),Sr(co,"Opening database:",e),new $i(function(i,o){var a=window.indexedDB.open(e,n);a.onsuccess=function(e){var n=e.target.result;i(new t(n))},a.onblocked=function(){o(new kr(Or.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new kr(Or.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},a.onupgradeneeded=function(t){Sr(co,'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result,i=new fo(a.transaction);r.createOrUpgrade(n,i,t.oldVersion,Vo).next(function(){Sr(co,"Database upgrade to version "+Vo+" complete")})}}).toPromise()},t.delete=function(t){return Sr(co,"Removing database:",t),mo(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var e=Object(s.f)(),n=t.getIOSVersion(e),r=0<n&&n<10,i=t.getAndroidVersion(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.getStore=function(t,e){return t.store(e)},t.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},t.prototype.runTransaction=function(t,e,n){var r=fo.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),$i.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},t.prototype.close=function(){this.db.close()},t}(),lo=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return mo(this.dbCursor.delete())},t}(),fo=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new wi,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=go(t.target.error);e.completionDeferred.reject(n)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Sr(co,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return Dr(!!e,"Object store not part of transaction: "+t),new po(e)},t}(),po=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Sr(co,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(Sr(co,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),mo(n)},t.prototype.add=function(t){return Sr(co,"ADD",this.store.name,t,t),mo(this.store.add(t))},t.prototype.get=function(t){var e=this;return mo(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Sr(co,"GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Sr(co,"DELETE",this.store.name,t),mo(this.store.delete(t))},t.prototype.count=function(){return Sr(co,"COUNT",this.store.name),mo(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){Sr(co,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new $i(function(n,r){e.onerror=function(t){var e=go(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,e){var n=[];return new $i(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new lo(i),a=e(i.primaryKey,i.value,o);if(a instanceof $i){var s=a.catch(function(t){return o.done(),$i.reject(t)});n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return $i.waitFor(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Dr(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mo(t){return new $i(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=go(t.target.error);n(e)}})}var yo=!1;function go(t){var e=ho.getIOSVersion(Object(s.f)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new kr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return yo||(yo=!0,setTimeout(function(){throw r},0)),r}}return t}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vo=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=uo.forQueryCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Ri.fromTimestamp(new _i(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return Eo(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},t.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return bo(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return Dr(e.targetCount>0,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return bo(t).iterate(function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return $i.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){var n=this;return bo(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},t.prototype.retrieveMetadata=function(t){return wo(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,wa.getStore(n,$o.store)).put($o.key,e);var n},t.prototype.saveQueryData=function(t,e){return bo(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return bo(t).iterate({range:i,index:Xo.queryTargetsIndexName},function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.query)&&(o=a,i.done())}).next(function(){return o})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=So(t);return e.forEach(function(e){var a=Ni(e.path);i.push(o.put(new Jo(n,a))),i.push(r.referenceDelegate.addReference(t,e))}),$i.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=So(t);return $i.forEach(e,function(e){var o=Ni(e.path);return $i.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=So(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=So(t),i=zi();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=ki(t[1]),o=new bi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Ni(e.path),r=IDBKeyRange.bound([n],[oi(n)],!1,!0),i=0;return So(t).iterate({index:Jo.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1];0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return bo(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function bo(t){return wa.getStore(t,Xo.store)}function wo(t){return ho.getStore(t,$o.store).get($o.key).next(function(t){return Dr(null!==t,"Missing metadata row."),t})}function Eo(t){return wo(t).next(function(t){return t.highestListenSequenceNumber})}function So(t){return wa.getStore(t,Jo.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var To=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return bi.comparator(t.key,e.key)},t}(),Io=function(t){function e(e,n,r,i,o){var a=t.call(this,e,n)||this;return a.data=r,a.proto=o,a.hasLocalMutations=!!i.hasLocalMutations,a.hasCommittedMutations=!!i.hasCommittedMutations,a}return Object(a.c)(e,t),e.prototype.field=function(t){return this.data.field(t)},e.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},e.prototype.value=function(){return this.data.value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Cr("Trying to compare documents on fields that don't exist")},e}(To),Co=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(a.c)(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(To),Do=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(To),No=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Pr(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}})},t.prototype.isEmpty=function(){return xr(this.inner)},t}(),Ao=function(){function t(){this.changes=Bi(),this.documentSizes=new No(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?$i.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return Dr(null!==this.changes,"Changes have already been applied."),this.changes},t}(),Oo="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",ko=function(){function t(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=ho.getStore(t,ea.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r=[];if(e.length>0){for(var i=Mo(t),o=zi(),a=0,s=e;a<s.length;a++){var u=s[a],c=u.key,h=u.doc;r.push(i.put(Po(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(Lo(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return $i.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=Mo(t),r=Po(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return xo(t)}):$i.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return Mo(t).get(Po(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return Mo(t).get(Po(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:xo(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=Ui();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=Ui(),i=new Mi(bi.comparator);return this.forEachDbEntry(t,e,function(t,e){e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i=i.insert(t,xo(e))):(r=r.insert(t,null),i=i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return $i.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Mo(t).iterate({range:r},function(t,e,r){for(var a=bi.fromSegments(t);o&&bi.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e){var n=this;Dr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=Qi(),i=e.path.length+1,o=e.path.toArray(),a=IDBKeyRange.lowerBound(o);return Mo(t).iterate({range:a},function(t,o,a){if(t.length===i){var s=n.serializer.fromDbRemoteDocument(o);e.path.isPrefixOf(s.key.path)?s instanceof Io&&e.matches(s)&&(r=r.insert(s.key,s)):a.done()}}).next(function(){return r})},t.prototype.getNewDocumentChanges=function(t){var e=this;Dr(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=zi(),r=Bi(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=Lo(t);return a.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(a).next(function(){return $i.reject(new kr(Or.DATA_LOSS,Oo))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new Co(n,Ri.forDeletedDoc());r=r.insert(n,e)}))}),$i.waitFor(i)}).next(function(){return r})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Lo(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},t.prototype.newChangeBuffer=function(){return new Ro(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return _o(t).get(Yo.key).next(function(t){return Dr(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return _o(t).put(Yo.key,e)},t.prototype.updateSize=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.setMetadata(t,r)})},t}();function _o(t){return wa.getStore(t,Yo.store)}var Ro=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return Object(a.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentCache.serializer.toDbRemoteDocument(n),a=e.documentSizes.get(t);Dr(void 0!==a,"Attempting to change document "+t.toString()+" without having read it first");var s=xo(o);r+=s-a,i.push({key:t,doc:o})}),this.documentCache.addEntries(t,i,r)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(Ao);function Mo(t){return wa.getStore(t,Ho.store)}function Lo(t){return wa.getStore(t,ea.store)}function Po(t){return t.path.toArray()}function xo(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Cr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qo=function(){function t(){this.collectionParentIndex=new Fo}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),$i.resolve()},t.prototype.getCollectionParents=function(t,e){return $i.resolve(this.collectionParentIndex.getEntries(e))},t}(),Fo=function(){function t(){this.index={}}return t.prototype.add=function(t){Dr(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new qi(yi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.getEntries=function(t){return(this.index[t]||new qi(yi.comparator)).toArray()},t}(),Vo=8,Bo=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Dr(n<r&&n>=0&&r<=Vo,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&r>=1&&(function(t){t.createObjectStore(jo.store)}(t),function(t){t.createObjectStore(Qo.store,{keyPath:Qo.keyPath}),t.createObjectStore(Ko.store,{keyPath:Ko.keyPath,autoIncrement:!0}).createIndex(Ko.userMutationsIndex,Ko.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Go.store)}(t),ta(t),function(t){t.createObjectStore(Ho.store)}(t));var o=$i.resolve();return n<3&&r>=3&&(0!==n&&(!function(t){t.deleteObjectStore(Jo.store),t.deleteObjectStore(Xo.store),t.deleteObjectStore($o.store)}(t),ta(t)),o=o.next(function(){return function(t){var e=t.store($o.store),n=new $o(0,0,Ri.MIN.toTimestamp(),0);return e.put($o.key,n)}(e)})),n<4&&r>=4&&(0!==n&&(o=o.next(function(){return function(t,e){return e.store(Ko.store).loadAll().next(function(n){t.deleteObjectStore(Ko.store),t.createObjectStore(Ko.store,{keyPath:Ko.keyPath,autoIncrement:!0}).createIndex(Ko.userMutationsIndex,Ko.userMutationsKeyPath,{unique:!0});var r=e.store(Ko.store),i=n.map(function(t){return r.put(t)});return $i.waitFor(i)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(na.store,{keyPath:na.keyPath})}(t),function(t){t.createObjectStore(ea.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&r>=5&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&r>=6&&(o=o.next(function(){return function(t){t.createObjectStore(Yo.store)}(t),i.addDocumentGlobal(e)})),n<7&&r>=7&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&r>=8&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Ho.store).iterate(function(t,n){e+=xo(n)}).next(function(){var n=new Yo(e);return t.store(Yo.store).put(Yo.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Qo.store),r=t.store(Ko.store);return n.loadAll().next(function(n){return $i.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(Ko.userMutationsIndex,i).next(function(r){return $i.forEach(r,function(r){Dr(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return eo(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Jo.store),n=t.store(Ho.store);return Eo(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new yi(n),a=function(t){return[0,Ni(t)]}(o);r.push(e.get(a).next(function(n){return n?$i.resolve():function(n){return e.put(new Jo(0,Ni(n),t))}(o)}))}).next(function(){return $i.waitFor(r)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Zo.store,{keyPath:Zo.keyPath});var n=e.store(Zo.store),r=new Fo,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Ni(i)})}};return e.store(Ho.store).iterate({keysOnly:!0},function(t,e){var n=new yi(t);return i(n.popLast())}).next(function(){return e.store(Go.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],ki(n));return i(r.popLast())})})},t}();var Uo=function(t,e){this.seconds=t,this.nanoseconds=e},jo=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var Qo=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),Ko=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var Go=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Ni(e)]},t.key=function(t,e,n){return[t,Ni(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var Wo=function(t,e){this.path=t,this.readTime=e},zo=function(t,e){this.path=t,this.version=e},Ho=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),Yo=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var Xo=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),Jo=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,Dr(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),$o=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),Zo=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function ta(t){t.createObjectStore(Jo.store,{keyPath:Jo.keyPath}).createIndex(Jo.documentTargetsIndex,Jo.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Xo.store,{keyPath:Xo.keyPath}).createIndex(Xo.queryTargetsIndexName,Xo.queryTargetsKeyPath,{unique:!0}),t.createObjectStore($o.store)}var ea=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}();var na=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}();var ra,ia=[Qo.store,Ko.store,Go.store,Ho.store,Xo.store,jo.store,$o.store,Jo.store].concat([na.store,ea.store]).concat([Yo.store]).concat([Zo.store]),oa=function(){function t(){this.collectionParentsCache=new Fo}return t.prototype.addToCollectionParentIndex=function(t,e){if(Dr(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Dr(e.length>=1,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return aa(t).put({collectionId:n,parent:Ni(r)})}return $i.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[oi(e),""],!1,!0);return aa(t).loadAll(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ki(o.parent))}return n})},t}();function aa(t){return wa.getStore(t,Zo.store)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution"}(ra||(ra={}));var sa=function(){function t(t,e,n,r,i,o){void 0===i&&(i=Ri.MIN),void 0===o&&(o=Ar()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return t.prototype.copy=function(e){return new t(this.query,this.targetId,this.purpose,void 0===e.sequenceNumber?this.sequenceNumber:e.sequenceNumber,void 0===e.snapshotVersion?this.snapshotVersion:e.snapshotVersion,void 0===e.resumeToken?this.resumeToken:e.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},t}(),ua=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=bi.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Co(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=bi.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new Do(e,n)}return Cr("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof Io){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Ho(null,null,e,n)}if(t instanceof Co){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);n=t.hasCommittedMutations;return new Ho(null,new Wo(r,i),null,n)}if(t instanceof Do){r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return new Ho(new zo(r,i),null,null,!0)}return Cr("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Uo(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new _i(t.seconds,t.nanoseconds);return Ri.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Ko(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=_i.fromMillis(t.localWriteTimeMs);return new Xi(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Ni(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=zi(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new bi(ki(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new sa(e,t.targetId,ra.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){Dr(ra.Listen===t.purpose,"Only queries with purpose "+ra.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),t.resumeToken instanceof Uint8Array?(Dr("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new Xo(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ca(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=ri(n,i);return 0===a?ri(r,o):a}var ha=function(){function t(t){this.maxElements=t,this.buffer=new qi(ca),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ca(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),la={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},fa=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),pa=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}return t.prototype.start=function(){Dr(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==fa.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;Dr(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Sr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(ui.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Ea)})},t}(),da=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return $i.resolve(di.INVALID);var r=new ha(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===fa.COLLECTION_DISABLED?(Sr("LruGarbageCollector","Garbage collection skipped; disabled"),$i.resolve(la)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Sr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),la):n.runGarbageCollection(t,e)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Sr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){(u=Date.now(),wr()<=lr.DEBUG)&&Sr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms");return $i.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),ma="IndexedDbPersistence",ya="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ga="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",va="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",ba=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return Object(a.c)(e,t),e}(function(){}),wa=function(){function t(e,n,r,i,o,a,s){if(this.persistenceKey=e,this.clientId=n,this.queue=i,this.multiClientParams=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!t.isAvailable())throw new kr(Or.UNIMPLEMENTED,va);if(this.referenceDelegate=new Da(this,a),this.dbName=e+t.MAIN_DATABASE,this.serializer=new ua(o),this.document=r.document,this.allowTabSynchronization=void 0!==s,this.queryCache=new vo(this.referenceDelegate,this.serializer),this.indexManager=new oa,this.remoteDocumentCache=new ko(this.serializer,this.indexManager,this.allowTabSynchronization),!r.window||!r.window.localStorage)throw new kr(Or.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof ba)return ho.getStore(t.simpleDbTransaction,e);throw Cr("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e,n,r,i,o,s){return Object(a.b)(this,void 0,void 0,function(){var u;return Object(a.d)(this,function(a){switch(a.label){case 0:return[4,(u=new t(e,n,r,i,o,s)).start()];case 1:return a.sent(),[2,u]}})})},t.createMultiClientIndexedDbPersistence=function(e,n,r,i,o,s,u){return Object(a.b)(this,void 0,void 0,function(){var c;return Object(a.d)(this,function(a){switch(a.label){case 0:return[4,(c=new t(e,n,r,i,o,s,u)).start()];case 1:return a.sent(),[2,c]}})})},t.prototype.start=function(){var t=this;return Dr(!this.started,"IndexedDbPersistence double-started!"),Dr(null!==this.window,"Expected 'window' to be defined"),ho.openOrCreate(this.dbName,Vo,new Bo(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.startRemoteDocumentCache()}).then(function(){return t.simpleDb.runTransaction("readonly",[$o.store],function(e){return Eo(e).next(function(e){var n=t.multiClientParams?t.multiClientParams.sequenceNumberSyncer:void 0;t.listenSequence=new di(e,n)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},t.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",ia,function(e){return t.remoteDocumentCache.start(e)})},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return Object(a.b)(e,void 0,void 0,function(){return Object(a.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener(function(n){return Object(a.b)(e,void 0,void 0,function(){return Object(a.d)(this,function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return Object(a.b)(e,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",ia,function(e){return Ta(e).put(new na(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},t.prototype.verifyPrimaryLease=function(t){var e=this;return Sa(t).get(jo.key).next(function(t){return $i.resolve(e.isLocalClient(t))})},t.prototype.removeClientMetadata=function(t){return Ta(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return Object(a.b)(this,void 0,void 0,function(){var e,n,r=this;return Object(a.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),n=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(i){var o=t.getStore(i,na.store);return o.loadAll().next(function(t){e=r.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)})}).next(function(){return $i.forEach(n,function(t){return o.delete(t.clientId)})}).next(function(){if((e=e.filter(function(t){return t.clientId!==r.clientId})).length>0){var t=e.map(function(t){return t.lastProcessedDocumentChangeId||0}),n=Math.min.apply(Math,t);return r.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,n)}})})]);case 1:i.sent(),n.forEach(function(t){r.window.localStorage.removeItem(r.zombiedClientLocalStorageKey(t.clientId))}),i.label=2;case 2:return[2]}})})},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(ui.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return Sa(t).get(jo.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new kr(Or.FAILED_PRECONDITION,ga);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ta(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&Sr(ma,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(a.b)(this,void 0,void 0,function(){var t=this;return Object(a.d)(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[jo.store,na.store],function(e){return t.releasePrimaryLeaseIfHeld(e).next(function(){return t.removeClientMetadata(e)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[na.store],function(e){return Ta(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},t.clearPersistence=function(e){return Object(a.b)(this,void 0,void 0,function(){var n;return Object(a.d)(this,function(r){switch(r.label){case 0:return t.isAvailable()?(n=e+t.MAIN_DATABASE,[4,ho.delete(n)]):[2,Promise.resolve()];case 1:return r.sent(),[2]}})})},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return Dr(this.started,"Cannot initialize MutationQueue before persistence is started."),Zi.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},t.prototype.getQueryCache=function(){return Dr(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},t.prototype.getRemoteDocumentCache=function(){return Dr(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.getIndexManager=function(){return Dr(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},t.prototype.runTransaction=function(t,e,n){var r=this;return Sr(ma,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",ia,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw Tr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new kr(Or.FAILED_PRECONDITION,ya);return n(new ba(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new ba(i,r.listenSequence.next()))})})},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return Sa(t).get(jo.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new kr(Or.FAILED_PRECONDITION,ga)})},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new jo(this.clientId,this.allowTabSynchronization,Date.now());return Sa(t).put(jo.key,e)},t.isAvailable=function(){return ho.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=Sa(t);return n.get(jo.key).next(function(t){return e.isLocalClient(t)?(Sr(ma,"Releasing primary lease."),n.delete(jo.key)):$i.resolve()})},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(t>n)||(Tr("Detected an update time that is in the future: "+t+" > "+n),!1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Dr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Dr("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Sr(ma,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Tr(ma,"Failed to get zombied client id.",t),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Tr("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function Ea(t){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(e){if(!function(t){return t.code===Or.FAILED_PRECONDITION&&t.message===ya}(t))throw t;return Sr(ma,"Unexpectedly lost primary lease"),[2]})})}function Sa(t){return t.store(jo.store)}function Ta(t){return t.store(na.store)}var Ia,Ca,Da=function(){function t(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new da(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return Na(t,e)},t.prototype.removeReference=function(t,e){return Na(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return Na(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?$i.resolve(!0):function(t,e){var n=!1;return oo(t).iterateSerial(function(r){return to(t,r,e).next(function(t){return t&&(n=!0),$i.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=0,o=[];return this.forEachOrphanedDocument(t,function(a,s){if(s<=e){var u=n.isPinned(t,a).next(function(e){if(!e)return r++,n.removeOrphanedDocument(t,a).next(function(t){i+=t})});o.push(u)}}).next(function(){return $i.waitFor(o)}).next(function(){return n.db.getRemoteDocumentCache().updateSize(t,-i)}).next(function(){return r})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return $i.waitFor([So(t).delete((n=e,[0,Ni(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Na(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=So(t),i=di.INVALID;return r.iterate({index:Jo.documentTargetsIndex},function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==di.INVALID&&e(new bi(ki(n)),i),i=s,n=a):i=di.INVALID}).next(function(){i!==di.INVALID&&e(new bi(ki(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Na(t,e){return So(t).put(function(t,e){return new Jo(0,Ni(t.path),e)}(e,t.currentSequenceNumber))}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue"}(Ia||(Ia={})),function(t){t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous"}(Ca||(Ca={}));var Aa=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(Ca.Estimate,n);case"previous":return new t(Ca.Previous,n);case"none":case void 0:return new t(Ca.Default,n);default:return Cr("fromSnapshotOptions() called with invalid options.")}},t}(),Oa=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return Dr(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),ri(this.typeOrder,t.typeOrder)},t}(),ka=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=Ia.NullValue,e.internalValue=null,e}return Object(a.c)(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(Oa),_a=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ia.BooleanValue,n}return Object(a.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?ri(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(Oa),Ra=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ia.NumberValue,n}return Object(a.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue,r=t.internalValue,n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1):this.defaultCompareTo(t);var n,r},e}(Oa);function Ma(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var La,Pa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Ma(this.internalValue,t.internalValue)},e}(Ra),xa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Ma(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(Ra),qa=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ia.StringValue,n}return Object(a.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?ri(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(Oa),Fa=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ia.TimestampValue,n}return Object(a.c)(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof Va?-1:this.defaultCompareTo(t)},e}(Oa),Va=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=Ia.TimestampValue,r}return Object(a.c)(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===Ca.Estimate?new Fa(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Ca.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Fa?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(Oa),Ba=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ia.BlobValue,n}return Object(a.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Oa),Ua=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=Ia.RefValue,r}return Object(a.c)(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:bi.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(Oa),ja=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ia.GeoPointValue,n}return Object(a.c)(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Oa),Qa=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ia.ObjectValue,n}return Object(a.c)(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),a=ri(i.key,o.key)||i.value.compareTo(o.value);if(a)return a}return ri(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(Dr(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(Dr(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return null!==this.field(t)},e.prototype.field=function(t){Dr(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach(function(t){n=n instanceof e?n.internalValue.get(t):null}),n},e.prototype.fieldMask=function(){var t=new qi(vi.comparator);return this.internalValue.forEach(function(n,r){var i=new vi([n]);if(r instanceof e){var o=r.fieldMask().fields;o.isEmpty()?t=t.add(i):o.forEach(function(e){t=t.add(i.child(e))})}else t=t.add(i)}),Ga.fromSet(t)},e.prototype.toString=function(){return this.internalValue.toString()},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new Mi(ri)),e}(Oa),Ka=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ia.ArrayValue,n}return Object(a.c)(e,t),e.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},e.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++){if(n[e].isEqual(t))return!0}return!1},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return ri(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},e}(Oa),Ga=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new qi(vi.comparator);return e.forEach(function(t){return n=n.add(t)}),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),Wa=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),za=function(t,e){this.version=t,this.transformResults=e};!function(t){t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete"}(La||(La={}));var Ha=function(){function t(t,e){this.updateTime=t,this.exists=e,Dr(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Io&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Io:(Dr(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),Ya=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&Dr(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof Io?t.version:Ri.MIN},t}(),Xa=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=La.Set,i}return Object(a.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Dr(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Io(this.key,n,this.value,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Ya.getPostMutationVersion(t);return new Io(this.key,r,this.value,{hasLocalMutations:!0})},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(Ya),Ja=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=La.Patch,o}return Object(a.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Dr(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Do(this.key,e.version);var n=this.patchDocument(t);return new Io(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Ya.getPostMutationVersion(t),i=this.patchDocument(t);return new Io(this.key,r,i,{hasLocalMutations:!0})},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof Io?t.data:Qa.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}}),t},e}(Ya),$a=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=La.Transform,r.precondition=Ha.exists(!0),r}return Object(a.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Dr(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Do(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new Io(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data,i);return new Io(this.key,r.version,o,{hasLocalMutations:!0})},e.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Io?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Qa.EMPTY.set(i.field,a):e.set(i.field,a))}return e},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&ii(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){Dr(t instanceof Io,"Unknown MaybeDocument type "+t);var e=t;return Dr(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];Dr(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Io&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Io&&(u=e.field(a.field)),null===u&&n instanceof Io&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},e.prototype.transformObject=function(t,e){Dr(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(Ya),Za=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=La.Delete,r}return Object(a.c)(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Dr(null==e.transformResults,"Transform results received by DeleteMutation."),new Co(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Dr(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Co(this.key,Ri.forDeletedDoc())):t},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},e}(Ya),ts=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++){t=i[r].applyToLocalView(e,t)}return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=Ui();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++){e=o[i].applyToLocalView(t,e)}r=r.insert(t,e)}),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=Bi();return i.forEach(function(t,e){e||(e=new Co(t,Ri.forDeletedDoc())),o=o.insert(t,e)}),o})},t.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new bi(e)).next(function(t){var e=Qi();return t instanceof Io&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e){var n=this;Dr(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=e.collectionGroup,i=Qi();return this.indexManager.getCollectionParents(t,r).next(function(o){return $i.forEach(o,function(o){var a=e.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(t,a).next(function(t){t.forEach(function(t,e){i=i.insert(t,e)})})}).next(function(){return i})})},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r,i=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(r){return n=r,i.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return r=e,i.addMissingBaseDocuments(t,r,n).next(function(t){n=t;for(var e=0,i=r;e<i.length;e++)for(var o=i[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof Io?n.insert(c,l):n.remove(c)}})}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},t.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=zi(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Ja&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Io&&(c=c.insert(t,e))}),c})},t}(),es=function(){function t(){this.refsByKey=new qi(ns.compareByKey),this.refsByTarget=new qi(ns.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new ns(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new ns(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=bi.EMPTY,r=new ns(n,t),i=new ns(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=bi.EMPTY,n=new ns(e,t),r=new ns(e,t+1),i=zi();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new ns(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),ns=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return bi.comparator(t.key,e.key)||ri(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return ri(t.targetOrBatchId,e.targetOrBatchId)||bi.comparator(t.key,e.key)},t}(),rs=function(){function t(t,e){this.persistence=t,this.localViewReferences=new es,this.queryDataByTarget={},Dr(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new ts(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}return t.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new ts(e.remoteDocuments,e.mutationQueue,e.persistence.getIndexManager()),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],a=zi(),s=0,u=r;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p];o.push(c.batchId);for(var m=0,y=c.mutations;m<y.length;m++){f=y[m];a=a.add(f.key)}}return e.localDocuments.getDocuments(n,a).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},t.prototype.localWrite=function(t){var e=this,n=_i.now(),r=t.reduce(function(t,e){return t.add(e.key)},zi());return this.persistence.runTransaction("Locally write mutations","readwrite",function(i){return e.localDocuments.getDocuments(i,r).next(function(r){for(var o=[],a=0,s=t;a<s.length;a++){var u=s[a],c=u.extractBaseValue(r.get(u.key));null!=c&&o.push(new Ja(u.key,c,c.fieldMask(),Ha.exists(!0)))}return e.mutationQueue.addMutationBatch(i,n,o,t).next(function(t){var e=t.applyToLocalDocumentSet(r);return{batchId:t.batchId,changes:e}})})})},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):$i.resolve(null)})})},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return Dr(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},t.prototype.applyRemoteEvent=function(e){var n=this,r=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var o=[],a=zi();Lr(e.targetChanges,function(r,s){var u=n.queryDataByTarget[r];if(u){s.addedDocuments.forEach(function(t){a=a.add(t)}),s.modifiedDocuments.forEach(function(t){a=a.add(t)}),o.push(n.queryCache.removeMatchingKeys(i,s.removedDocuments,r).next(function(){return n.queryCache.addMatchingKeys(i,s.addedDocuments,r)}));var c=s.resumeToken;if(c.length>0){var h=u;u=u.copy({resumeToken:c,snapshotVersion:e.snapshotVersion}),n.queryDataByTarget[r]=u,t.shouldPersistQueryData(h,u,s)&&o.push(n.queryCache.updateQueryData(i,u))}}});var s=Bi(),u=zi();e.documentUpdates.forEach(function(t,e){u=u.add(t)}),o.push(r.getEntries(i,u).next(function(t){e.documentUpdates.forEach(function(u,c){var h=t.get(u);null==h||c.version.isEqual(Ri.MIN)||a.has(c.key)&&!h.hasPendingWrites||c.version.compareTo(h.version)>=0?(r.addEntry(c),s=s.insert(u,c)):Sr("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),e.resolvedLimboDocuments.has(u)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))})}));var c=e.snapshotVersion;if(!c.isEqual(Ri.MIN)){var h=n.queryCache.getLastRemoteSnapshotVersion(i).next(function(t){return Dr(c.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+c+" < "+t),n.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,c)});o.push(h)}return $i.waitFor(o).next(function(){return r.apply(i)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(i,s)})})},t.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0))},t.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return $i.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),$i.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},t.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,$i.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new sa(t,i,ra.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return Dr(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r,r})})},t.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,t).next(function(i){Dr(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,a=n.queryDataByTarget[o],s=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?$i.resolve():$i.forEach(s,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,a)})})})},t.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=$i.resolve();return o.forEach(function(r){a=a.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,a=e.docVersions.get(r);Dr(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):Dr(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),a.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.queryDataByTarget)})},t.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),is=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Ar(),this.batchesByDocumentKey=new qi(ns.compareByKey)}return t.prototype.checkEmpty=function(t){return $i.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Dr(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Dr(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,$i.resolve()},t.prototype.getLastStreamToken=function(t){return $i.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,$i.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){Dr(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;(this.nextBatchId++,this.mutationQueue.length>0)&&Dr(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Xi(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new ns(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return $i.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return $i.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Dr(null!=n,"Failed to find local mutation batch."),$i.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return $i.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getAllMutationBatches=function(t){return $i.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new ns(e,0),i=new ns(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){Dr(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);Dr(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),$i.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new qi(ri);return e.forEach(function(t){var e=new ns(t,0),i=new ns(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){Dr(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),$i.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Dr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;bi.isDocumentKey(i)||(i=i.child(""));var o=new ns(new bi(i),0),a=new qi(ri);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),$i.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Dr(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return $i.forEach(e.mutations,function(i){var o=new ns(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new ns(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return $i.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Dr(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),$i.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Dr(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Dr(n.batchId===t,"If found batch must match"),n},t}(),os=function(){function t(t){this.persistence=t,this.queries=new No(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Ri.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new es,this.targetCount=0,this.targetIdGenerator=uo.forQueryCache()}return t.prototype.getTargetCount=function(t){return $i.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),$i.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return $i.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return $i.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,$i.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),$i.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return Dr(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,$i.resolve()},t.prototype.updateQueryData=function(t,e){return Dr(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),$i.resolve()},t.prototype.removeQueryData=function(t,e){return Dr(this.targetCount>0,"Removing a target from an empty cache"),Dr(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,$i.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(a,s){s.sequenceNumber<=e&&!n[s.targetId]&&(r.queries.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),$i.waitFor(o).next(function(){return i})},t.prototype.getQueryCount=function(t){return $i.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return $i.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return Cr("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),$i.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),$i.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),$i.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return $i.resolve(n)},t.prototype.containsKey=function(t,e){return $i.resolve(this.references.containsKey(e))},t}();var as=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new Mi(bi.comparator),this.newDocumentChanges=zi(),this.size=0}return t.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.maybeDocument.key;this.docs=this.docs.insert(s,a),this.newDocumentChanges=this.newDocumentChanges.add(s),r.push(this.indexManager.addToCollectionParentIndex(t,s.path.popLast()))}return this.size+=n,$i.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,$i.resolve(n.size)):$i.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return $i.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return $i.resolve(this.docs.get(e))},t.prototype.getEntries=function(t,e){var n=this,r=Ui();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),$i.resolve(r)},t.prototype.getSizedEntries=function(t,e){var n=this,r=Ui(),i=new Mi(bi.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),$i.resolve({maybeDocuments:r,sizeMap:i})},t.prototype.getDocumentsMatchingQuery=function(t,e){Dr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=Qi(),r=new bi(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof Io&&e.matches(s)&&(n=n.insert(s.key,s))}return $i.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return $i.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var e=this,n=Bi();return this.newDocumentChanges.forEach(function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new Co(t,Ri.forDeletedDoc());n=n.insert(t,i)}),this.newDocumentChanges=zi(),$i.resolve(n)},t.prototype.newChangeBuffer=function(){return new ss(this.sizer,this)},t.prototype.getSize=function(t){return $i.resolve(this.size)},t}(),ss=function(t){function e(e,n){var r=t.call(this)||this;return r.sizer=e,r.documentCache=n,r}return Object(a.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentSizes.get(t);Dr(void 0!==o,"Attempting to change document "+t.toString()+" without having read it first");var a=e.sizer(n);r+=a-o,i.push({maybeDocument:n,size:a})}),this.documentCache.addEntries(t,i,r)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(Ao),us=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new di(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new os(this);this.indexManager=new qo,this.remoteDocumentCache=new as(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return t.createLruPersistence=function(e,n,r){return new t(e,function(t){return new ls(t,new ua(n),r)})},t.createEagerPersistence=function(e){return new t(e,function(t){return new hs(t)})},t.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){return[2,[this.clientId]]})})},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(t){},t.prototype.getIndexManager=function(){return this.indexManager},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new is(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getQueryCache=function(){return this.queryCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;Sr("MemoryPersistence","Starting transaction:",t);var i=new cs(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},t.prototype.mutationQueuesContainKey=function(t,e){return $i.or((n=this.mutationQueues,r=[],Pr(n,function(t,e){return r.push(e)}),r).map(function(n){return function(){return n.containsKey(t,e)}}));var n,r},t}(),cs=function(t){this.currentSequenceNumber=t},hs=function(){function t(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}return Object.defineProperty(t.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Cr("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),$i.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),$i.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),$i.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache();return $i.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(e){return e?$i.resolve():n.removeEntry(t,r).next(function(){})})}).next(function(){e._orphanedDocuments=null})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return $i.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return $i.resolve(n.inMemoryPins.containsKey(e))}])},t}(),ls=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new No(function(t){return Ni(t.path)}),this.garbageCollector=new da(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return $i.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return $i.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?$i.resolve():e(i)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache();return i.forEachDocumentKey(t,function(o){return n.isPinned(t,o,e).next(function(e){return e?$i.resolve():(r++,i.removeEntry(t,o).next())})}).next(function(){return r})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),$i.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),$i.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),$i.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),$i.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Cr("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return $i.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return $i.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return $i.resolve(void 0!==t&&t>n)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),fs=Number,ps=fs.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),ds=fs.MAX_SAFE_INTEGER||Math.pow(2,53)-1,ms=fs.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function ys(t){return null==t}function gs(t){return ms(t)&&t<=ds&&t>=ps}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vs,bs=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&Sr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}();!function(t){t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff"}(vs||(vs={}));var ws,Es,Ss=1e3,Ts=6e4,Is=1.5,Cs=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=vs.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new bs(t,e,Ss,Is,Ts)}return t.prototype.isStarted=function(){return this.state===vs.Starting||this.state===vs.Open||this.state===vs.Backoff},t.prototype.isOpen=function(){return this.state===vs.Open},t.prototype.start=function(){this.state!==vs.Error?(Dr(this.state===vs.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(vs.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){Dr(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=vs.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){return this.isOpen()?[2,this.close(vs.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(n){switch(n.label){case 0:return Dr(this.isStarted(),"Only started streams should be closed."),Dr(t===vs.Error||ys(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==vs.Error?this.backoff.reset():e&&e.code===Or.RESOURCE_EXHAUSTED?(Tr(e.toString()),Tr("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Or.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;Dr(this.state===vs.Initial,"Must be in initial state to auth"),this.state=vs.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new kr(Or.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},t.prototype.startStream=function(t){var e=this;Dr(this.state===vs.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Dr(e.state===vs.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=vs.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;Dr(this.state===vs.Error,"Should only perform backoff when in Error state"),this.state=vs.Backoff,this.backoff.backoffAndRun(function(){return Object(a.b)(t,void 0,void 0,function(){return Object(a.d)(this,function(t){return Dr(this.state===vs.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=vs.Initial,this.start(),Dr(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return Dr(this.isStarted(),"Can't handle server close on non-started stream"),Sr("PersistentStream","close with error: "+t),this.stream=null,this.close(vs.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(Sr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Ds=function(t){function e(e,n,r,i,o){var a=t.call(this,e,ui.ListenStreamConnectionBackoff,ui.ListenStreamIdle,n,r,o)||this;return a.serializer=i,a}return Object(a.c)(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(Cs),Ns=function(t){function e(e,n,r,i,o){var a=t.call(this,e,ui.WriteStreamConnectionBackoff,ui.WriteStreamIdle,n,r,o)||this;return a.serializer=i,a.handshakeComplete_=!1,a.lastStreamToken=Ar(),a}return Object(a.c)(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(Dr(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Dr(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){Dr(this.isOpen(),"Writing handshake requires an opened stream"),Dr(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;Dr(this.isOpen(),"Writing mutations requires an opened stream"),Dr(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Dr(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},e}(Cs),As=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Ns(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Ds(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=Bi();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);Dr(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===Or.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===Or.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t}(),Os=function(){function t(t){this.datastore=t,this.readVersions=Gi(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n=this;return Object(a.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new kr(Or.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach(function(t){t instanceof Co||t instanceof Io?n.recordVersion(t):Cr("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},t.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},t.prototype.delete=function(t){this.write([new Za(t,this.precondition(t))]),this.writtenDocs.add(t)},t.prototype.commit=function(){return Object(a.b)(this,void 0,void 0,function(){var t;return Object(a.d)(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach(function(e){t=t.remove(e.key)}),!t.isEmpty())throw new kr(Or.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t instanceof Io)e=t.version;else{if(!(t instanceof Co))throw Cr("Document in a transaction was a "+t.constructor.name);e=Ri.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new kr(Or.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?Ha.updateTime(e):Ha.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(!this.writtenDocs.has(t)&&e){if(e.isEqual(Ri.forDeletedDoc()))throw new kr(Or.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ha.updateTime(e)}return Ha.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},t.prototype.ensureCommitNotCalled=function(){Dr(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},t}();!function(t){t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline"}(ws||(ws={})),function(t){t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState"}(Es||(Es={}));
/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ks,_s=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=ws.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(ws.Unknown),Dr(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(ui.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Dr(t.state===ws.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(ws.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===ws.Online?(this.setAndBroadcast(ws.Unknown),Dr(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Dr(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(ws.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===ws.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Tr(e),this.shouldWarnClientIsOffline=!1):Sr("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}();function Rs(t){switch(t){case Or.OK:return Cr("Treated status OK as error");case Or.CANCELLED:case Or.UNKNOWN:case Or.DEADLINE_EXCEEDED:case Or.RESOURCE_EXHAUSTED:case Or.INTERNAL:case Or.UNAVAILABLE:case Or.UNAUTHENTICATED:return!1;case Or.INVALID_ARGUMENT:case Or.NOT_FOUND:case Or.ALREADY_EXISTS:case Or.PERMISSION_DENIED:case Or.FAILED_PRECONDITION:case Or.ABORTED:case Or.OUT_OF_RANGE:case Or.UNIMPLEMENTED:case Or.DATA_LOSS:return!0;default:return Cr("Unknown status code: "+t)}}function Ms(t){if(void 0===t)return Tr("GRPC error has no .code"),Or.UNKNOWN;switch(t){case ks.OK:return Or.OK;case ks.CANCELLED:return Or.CANCELLED;case ks.UNKNOWN:return Or.UNKNOWN;case ks.DEADLINE_EXCEEDED:return Or.DEADLINE_EXCEEDED;case ks.RESOURCE_EXHAUSTED:return Or.RESOURCE_EXHAUSTED;case ks.INTERNAL:return Or.INTERNAL;case ks.UNAVAILABLE:return Or.UNAVAILABLE;case ks.UNAUTHENTICATED:return Or.UNAUTHENTICATED;case ks.INVALID_ARGUMENT:return Or.INVALID_ARGUMENT;case ks.NOT_FOUND:return Or.NOT_FOUND;case ks.ALREADY_EXISTS:return Or.ALREADY_EXISTS;case ks.PERMISSION_DENIED:return Or.PERMISSION_DENIED;case ks.FAILED_PRECONDITION:return Or.FAILED_PRECONDITION;case ks.ABORTED:return Or.ABORTED;case ks.OUT_OF_RANGE:return Or.OUT_OF_RANGE;case ks.UNIMPLEMENTED:return Or.UNIMPLEMENTED;case ks.DATA_LOSS:return Or.DATA_LOSS;default:return Cr("Unknown status code: "+t)}}function Ls(t){if(void 0===t)return ks.OK;switch(t){case Or.OK:return ks.OK;case Or.CANCELLED:return ks.CANCELLED;case Or.UNKNOWN:return ks.UNKNOWN;case Or.DEADLINE_EXCEEDED:return ks.DEADLINE_EXCEEDED;case Or.RESOURCE_EXHAUSTED:return ks.RESOURCE_EXHAUSTED;case Or.INTERNAL:return ks.INTERNAL;case Or.UNAVAILABLE:return ks.UNAVAILABLE;case Or.UNAUTHENTICATED:return ks.UNAUTHENTICATED;case Or.INVALID_ARGUMENT:return ks.INVALID_ARGUMENT;case Or.NOT_FOUND:return ks.NOT_FOUND;case Or.ALREADY_EXISTS:return ks.ALREADY_EXISTS;case Or.PERMISSION_DENIED:return ks.PERMISSION_DENIED;case Or.FAILED_PRECONDITION:return ks.FAILED_PRECONDITION;case Or.ABORTED:return ks.ABORTED;case Or.OUT_OF_RANGE:return ks.OUT_OF_RANGE;case Or.UNIMPLEMENTED:return ks.UNIMPLEMENTED;case Or.DATA_LOSS:return ks.DATA_LOSS;default:return Cr("Unknown status code: "+t)}}!function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS"}(ks||(ks={}));
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ps,xs,qs=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||bi.comparator(e.key,n.key)}:function(t,e){return bi.comparator(t.key,e.key)},this.keyedMap=Qi(),this.sortedSet=new Mi(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata"}(Ps||(Ps={})),function(t){t[t.Local=0]="Local",t[t.Synced=1]="Synced"}(xs||(xs={}));var Fs,Vs=function(){function t(){this.changeMap=new Mi(bi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==Ps.Added&&n.type===Ps.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===Ps.Metadata&&n.type!==Ps.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===Ps.Modified&&n.type===Ps.Modified?this.changeMap=this.changeMap.insert(e,{type:Ps.Modified,doc:t.doc}):t.type===Ps.Modified&&n.type===Ps.Added?this.changeMap=this.changeMap.insert(e,{type:Ps.Added,doc:t.doc}):t.type===Ps.Removed&&n.type===Ps.Added?this.changeMap=this.changeMap.remove(e):t.type===Ps.Removed&&n.type===Ps.Modified?this.changeMap=this.changeMap.insert(e,{type:Ps.Removed,doc:n.doc}):t.type===Ps.Added&&n.type===Ps.Removed?this.changeMap=this.changeMap.insert(e,{type:Ps.Modified,doc:t.doc}):Cr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Bs=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:Ps.Added,doc:t})}),new t(e,n,qs.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Us=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=js.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(Ri.MIN,i,Yi(),Bi(),zi())},t}(),js=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Ar(),n,zi(),zi(),zi())},t}(),Qs=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},Ks=function(t,e){this.targetId=t,this.existenceFilter=e};!function(t){t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset"}(Fs||(Fs={}));var Gs=function(t,e,n,r){void 0===n&&(n=Ar()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Ws=function(){function t(){this.pendingResponses=0,this.documentChanges=Ys(),this._resumeToken=Ar(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=zi(),e=zi(),n=zi();return this.documentChanges.forEach(function(r,i){switch(i){case Ps.Added:t=t.add(r);break;case Ps.Modified:e=e.add(r);break;case Ps.Removed:n=n.add(r);break;default:Cr("Encountered invalid change type: "+i)}}),new js(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=Ys()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),zs=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Bi(),this.pendingDocumentTargetMapping=Hs(),this.pendingTargetResets=new qi(ri)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Io?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Co&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,t.key,t.newDoc)}},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case Fs.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case Fs.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case Fs.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),Dr(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case Fs.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case Fs.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:Cr("Unknown target watch change state: "+t.state)}})},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):Lr(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new bi(i.path);this.removeDocumentFromTarget(e,o,new Co(o,Ri.forDeletedDoc()))}else Dr(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};Lr(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var a=new bi(o.query.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new Co(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=zi();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===ra.LimboResolution||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Us(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Bi(),this.pendingDocumentTargetMapping=Hs(),this.pendingTargetResets=new qi(ri),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?Ps.Modified:Ps.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,Ps.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new Ws),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new qi(ri),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||Sr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;Dr(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new Ws,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function Hs(){return new Mi(bi.comparator)}function Ys(){return new Mi(bi.comparator)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xs="RemoteStore",Js=function(){function t(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return Object(a.b)(o,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Sr(Xs,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new _s(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return Object(a.b)(this,void 0,void 0,function(){var t;return Object(a.d)(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(ws.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(ws.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(Sr(Xs,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return Sr(Xs,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(ws.Unknown),[2]}})})},t.prototype.listen=function(t){Dr(!Rr(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){Dr(Rr(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),xr(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(ws.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){Dr(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new zs(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!xr(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return Object(a.b)(this,void 0,void 0,function(){var t=this;return Object(a.d)(this,function(e){return Lr(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},t.prototype.onWatchStreamClose=function(t){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(e){return void 0===t&&Dr(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(ws.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(t,e){return Object(a.b)(this,void 0,void 0,function(){var n;return Object(a.d)(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(ws.Online),t instanceof Gs&&t.state===Fs.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof Qs?this.watchChangeAggregator.handleDocumentChange(t):t instanceof Ks?this.watchChangeAggregator.handleExistenceFilter(t):(Dr(t instanceof Gs,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(Ri.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(t){var e=this;Dr(!t.isEqual(Ri.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return Lr(n.targetChanges,function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:t}))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.copy({resumeToken:Ar()}),e.sendUnwatchRequest(t);var r=new sa(n.query,t,ra.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;Dr(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return Object(a.b)(e,void 0,void 0,function(){return Object(a.d)(this,function(e){return Rr(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},t.prototype.fillWritePipeline=function(){return Object(a.b)(this,void 0,void 0,function(){var t,e;return Object(a.d)(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){Dr(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){Dr(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(Ea)},t.prototype.onMutationResult=function(t,e){var n=this;Dr(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Ji.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(t){return Object(a.b)(this,void 0,void 0,function(){var e=this;return Object(a.d)(this,function(n){return void 0===t&&Dr(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]):[2]})})},t.prototype.handleHandshakeError=function(t){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(e){return Rs(t.code)?(Sr(Xs,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Ar(),[2,this.localStore.setLastStreamToken(Ar()).catch(Ea)]):[2]})})},t.prototype.handleWriteError=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n=this;return Object(a.d)(this,function(r){return Rs(i=t.code)&&i!==Or.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2];var i})})},t.prototype.createTransaction=function(){return new Os(this.datastore)},t.prototype.restartNetwork=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(ws.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},t.prototype.handleCredentialChange=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Sr(Xs,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.applyPrimaryState=function(t){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(ws.Unknown),e.label=4;case 4:return[2]}})})},t}(),$s=function(){function t(t,e){if(Fr("GeoPoint",arguments,2),Ur("GeoPoint","number",1,t),Ur("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new kr(Or.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new kr(Or.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return ri(this._lat,t._lat)||ri(this._long,t._long)},t}(),Zs=function(){function t(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[lu]:this.memoizedOrderBy=[new hu(t),lu];else{Dr(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:uu.ASCENDING;this.memoizedOrderBy.push(a===uu.ASCENDING?lu:fu)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){Dr(null==this.getInequalityFilterField()||!(e instanceof nu)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Dr(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){Dr(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.withLimit=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,e)},t.prototype.asCollectionQueryAtPath=function(e){return new t(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}ys(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),ys(this.limit)||(t+=", limit: "+this.limit),this.explicitOrderBy.length>0&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Dr(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimit=function(){return!ys(this.limit)},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof nu&&n.isInequality())return n.field}return null},t.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof nu&&t.indexOf(r.op)>=0)return r.op}return null},t.prototype.isDocumentQuery=function(){return bi.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},t.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},t.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):bi.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){Dr(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),tu=function(){},eu=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;case"in":return t.IN;case"array-contains-any":return t.ARRAY_CONTAINS_ANY;default:return Cr("Unknown FieldFilter operator: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t.IN=new t("in"),t.ARRAY_CONTAINS_ANY=new t("array-contains-any"),t}(),nu=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return Object(a.c)(e,t),e.create=function(t,n,r){if(t.isKeyField())return n===eu.IN?(Dr(r instanceof Ka,"Comparing on key with IN, but filter value not an ArrayValue"),Dr(r.internalValue.every(function(t){return t instanceof Ua}),"Comparing on key with IN, but an array value was not a RefValue"),new iu(t,r)):(Dr(r instanceof Ua,"Comparing on key, but filter value not a RefValue"),Dr(n!==eu.ARRAY_CONTAINS&&n!==eu.ARRAY_CONTAINS_ANY,"'"+n.toString()+"' queries don't make sense on document keys."),new ru(t,n,r));if(r.isEqual(ka.INSTANCE)){if(n!==eu.EQUAL)throw new kr(Or.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(r.isEqual(xa.NAN)){if(n!==eu.EQUAL)throw new kr(Or.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return n===eu.ARRAY_CONTAINS?new ou(t,r):n===eu.IN?(Dr(r instanceof Ka,"IN filter has invalid value: "+r.toString()),new au(t,r)):n===eu.ARRAY_CONTAINS_ANY?(Dr(r instanceof Ka,"ARRAY_CONTAINS_ANY filter has invalid value: "+r.toString()),new su(t,r)):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case eu.LESS_THAN:return t<0;case eu.LESS_THAN_OR_EQUAL:return t<=0;case eu.EQUAL:return 0===t;case eu.GREATER_THAN:return t>0;case eu.GREATER_THAN_OR_EQUAL:return t>=0;default:return Cr("Unknown FieldFilter operator: "+this.op)}},e.prototype.isInequality=function(){return[eu.LESS_THAN,eu.LESS_THAN_OR_EQUAL,eu.GREATER_THAN,eu.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(tu),ru=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.matches=function(t){var e=this.value,n=bi.comparator(t.key,e.key);return this.matchesComparison(n)},e}(nu),iu=function(t){function e(e,n){var r=t.call(this,e,eu.IN,n)||this;return r.value=n,r}return Object(a.c)(e,t),e.prototype.matches=function(t){return this.value.internalValue.some(function(e){return t.key.isEqual(e.key)})},e}(nu),ou=function(t){function e(e,n){return t.call(this,e,eu.ARRAY_CONTAINS,n)||this}return Object(a.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Ka&&e.contains(this.value)},e}(nu),au=function(t){function e(e,n){var r=t.call(this,e,eu.IN,n)||this;return r.value=n,r}return Object(a.c)(e,t),e.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},e}(nu),su=function(t){function e(e,n){var r=t.call(this,e,eu.ARRAY_CONTAINS_ANY,n)||this;return r.value=n,r}return Object(a.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Ka&&n.internalValue.some(function(t){return e.value.contains(t)})},e}(nu),uu=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),cu=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.sortsBeforeDocument=function(t,e){Dr(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Dr(o instanceof Ua,"Bound has a non-key value where the key path is being used."),n=bi.comparator(o.key,e.key);else{var a=e.field(i.field);Dr(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===uu.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},t}(),hu=function(){function t(t,e){this.field=t,void 0===e&&(e=uu.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Io.compareByKey(t,e):Io.compareByField(this.field,t,e);switch(this.dir){case uu.ASCENDING:return n;case uu.DESCENDING:return-1*n;default:return Cr("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),lu=new hu(vi.keyField(),uu.ASCENDING),fu=new hu(vi.keyField(),uu.DESCENDING),pu=function(){function t(){}return t.prototype.applyToLocalView=function(t,e){return new Va(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),du=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=gu(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new Ka(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&ii(e.elements,this.elements)},t}(),mu=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=gu(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new Ka(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&ii(e.elements,this.elements)},t}(),yu=function(){function t(t){this.operand=t}return t.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Pa&&this.operand instanceof Pa){var r=n.internalValue+this.operand.internalValue;return new Pa(r)}r=n.internalValue+this.operand.internalValue;return new xa(r)},t.prototype.applyToRemoteDocument=function(t,e){return Dr(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.computeBaseValue=function(t){return t instanceof Ra?t:new Pa(0)},t.prototype.isEqual=function(e){return e instanceof t&&this.operand.isEqual(e.operand)},t}();function gu(t){return t instanceof Ka?t.internalValue.slice():[]}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vu,bu,wu=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}(),Eu=((vu={})[uu.ASCENDING.name]="ASCENDING",vu[uu.DESCENDING.name]="DESCENDING",vu),Su=((bu={})[eu.LESS_THAN.name]="LESS_THAN",bu[eu.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",bu[eu.GREATER_THAN.name]="GREATER_THAN",bu[eu.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",bu[eu.EQUAL.name]="EQUAL",bu[eu.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",bu[eu.IN.name]="IN",bu[eu.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",bu),Tu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iu(t,e){Dr(!ys(t),e+" is missing")}function Cu(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Cr("can't parse "+t)}var Du=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Or.UNKNOWN:Ms(t.code);return new kr(e,t.message||"")},t.prototype.toInt32Value=function(t){return ys(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return ys(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Dr(!!t,"Cannot deserialize null or undefined timestamp.");var e=Cu(t.seconds||"0"),n=t.nanos||0;return new _i(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=Tu.exec(t);if(Dr(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new _i(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(Dr(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),ci.fromBase64String(t)):(Dr(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),ci.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return Dr(!!t,"Trying to deserialize version that isn't set"),Ri.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=yi.fromString(t);return Dr(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return Dr(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Dr(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new bi(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?yi.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new yi(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new yi(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return Dr(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof ka)return{nullValue:"NULL_VALUE"};if(t instanceof _a)return{booleanValue:t.value()};if(t instanceof Pa)return{integerValue:""+t.value()};if(t instanceof xa){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof qa?{stringValue:t.value()}:t instanceof Qa?{mapValue:this.toMapValue(t)}:t instanceof Ka?{arrayValue:this.toArrayValue(t)}:t instanceof Fa?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof ja?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Ba?{bytesValue:this.toBytes(t.value())}:t instanceof Ua?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Cr("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return ka.INSTANCE;if("booleanValue"in t)return _a.of(t.booleanValue);if("integerValue"in t)return new Pa(Cu(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return xa.NAN;if("Infinity"===t.doubleValue)return xa.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return xa.NEGATIVE_INFINITY}return new xa(t.doubleValue)}if("stringValue"in t)return new qa(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){Iu(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Ka(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return Iu(t.timestampValue,"timestampValue"),new Fa(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){Iu(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new ja(new $s(r,i))}if("bytesValue"in t){Iu(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Ba(o)}if("referenceValue"in t){Iu(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new pi(a.get(1),a.get(3)),u=new bi(this.extractLocalPathFromResourceName(a));return new Ua(s,u)}return Cr("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return Dr(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new Io(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},t.prototype.fromFields=function(t){var e=this,n=t,r=Qa.EMPTY;return Pr(n,function(t,n){r=r.set(new vi([t]),e.fromValue(n))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){Dr(!!t.found,"Tried to deserialize a found document from a missing document."),Iu(t.found.name,"doc.found.name"),Iu(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new Io(e,n,r,{},t.found)},t.prototype.fromMissing=function(t){Dr(!!t.missing,"Tried to deserialize a missing document from a found document."),Dr(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Co(e,n)},t.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Cr("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case Fs.Added:return"ADD";case Fs.Current:return"CURRENT";case Fs.NoChange:return"NO_CHANGE";case Fs.Removed:return"REMOVE";case Fs.Reset:return"RESET";default:return Cr("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof Ks)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof Qs){if(t.newDoc instanceof Io){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Co){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof Gs){var n=void 0;return t.cause&&(n={code:Ls(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Cr("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e;if("targetChange"in t){Iu(t.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=t.targetChange.resumeToken||this.emptyByteString(),o=t.targetChange.cause,a=o&&this.fromRpcStatus(o);e=new Gs(n,r,i,a||null)}else if("documentChange"in t){Iu(t.documentChange,"documentChange"),Iu(t.documentChange.document,"documentChange.name"),Iu(t.documentChange.document.name,"documentChange.document.name"),Iu(t.documentChange.document.updateTime,"documentChange.document.updateTime");var s=t.documentChange,u=this.fromName(s.document.name),c=this.fromVersion(s.document.updateTime),h=this.fromFields(s.document.fields||{}),l=new Io(u,c,h,{},s.document),f=s.targetIds||[],p=s.removedTargetIds||[];e=new Qs(f,p,l.key,l)}else if("documentDelete"in t){Iu(t.documentDelete,"documentDelete"),Iu(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;u=this.fromName(d.document),c=d.readTime?this.fromVersion(d.readTime):Ri.forDeletedDoc(),l=new Co(u,c),p=d.removedTargetIds||[];e=new Qs([],p,l.key,l)}else if("documentRemove"in t){Iu(t.documentRemove,"documentRemove"),Iu(t.documentRemove.document,"documentRemove");var m=t.documentRemove;u=this.fromName(m.document),p=m.removedTargetIds||[];e=new Qs([],p,u,null)}else{if(!("filter"in t))return Cr("Unknown change type "+JSON.stringify(t));Iu(t.filter,"filter"),Iu(t.filter.targetId,"filter.targetId");var y=t.filter,g=y.count||0,v=new wu(g),b=y.targetId;e=new Ks(b,v)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?Fs.NoChange:"ADD"===t?Fs.Added:"REMOVE"===t?Fs.Removed:"CURRENT"===t?Fs.Current:"RESET"===t?Fs.Reset:Cr("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Ri.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ri.MIN:e.readTime?this.fromVersion(e.readTime):Ri.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof Xa)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Za)e={delete:this.toName(t.key)};else if(t instanceof Ja)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof $a))return Cr("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Ha.NONE;if(t.update){Iu(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Ja(r,i,o,n)}return new Xa(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new Za(r,n)}if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Dr(!0===n.exists,'Transforms only support precondition "exists == true"'),new $a(r,a)}return Cr("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return Dr(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Cr("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Ha.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Ha.exists(t.exists):Ha.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new za(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(Dr(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof pu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof du)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof mu)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof yu)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Cr("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Dr("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=pu.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new du(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t){r=t.removeAllFromArray.values||[];n=new mu(r.map(function(t){return e.fromValue(t)}))}else if("increment"in t){var i=this.fromValue(t.increment);Dr(i instanceof Ra,"NUMERIC_ADD transform requires a NumberValue"),n=new yu(i)}else Cr("Unknown transform proto: "+JSON.stringify(t));var o=vi.fromServerFormat(t.fieldPath);return new Wa(o,n)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Dr(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Zs.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Dr(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Dr(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Dr(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new Zs(e,i,s,a,u,c,h)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case ra.Listen:return null;case ra.ExistenceFilterMismatch:return"existence-filter-mismatch";case ra.LimboResolution:return"limbo-document";default:return Cr("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof nu?e.toUnaryOrFieldFilter(t):Cr("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Cr("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new cu(r,n)},t.prototype.toDirection=function(t){return Eu[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return uu.ASCENDING;case"DESCENDING":return uu.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return Su[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return eu.EQUAL;case"GREATER_THAN":return eu.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return eu.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return eu.LESS_THAN;case"LESS_THAN_OR_EQUAL":return eu.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return eu.ARRAY_CONTAINS;case"IN":return eu.IN;case"ARRAY_CONTAINS_ANY":return eu.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Cr("Unspecified operator");default:return Cr("Unknown operator")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return vi.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new hu(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.fromFieldFilter=function(t){return nu.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryOrFieldFilter=function(t){if(t.op===eu.EQUAL){if(t.value.isEqual(xa.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(ka.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return nu.create(e,eu.EQUAL,xa.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return nu.create(n,eu.EQUAL,ka.INSTANCE);case"OPERATOR_UNSPECIFIED":return Cr("Unspecified filter");default:return Cr("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return vi.fromServerFormat(t)});return Ga.fromArray(e)},t}(),Nu=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},Au=function(){function t(t){this.syncEngine=t,this.queries=new No(function(t){return t.canonicalId()}),this.onlineState=ws.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new Nu,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t,t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n,r,i;return Object(a.d)(this,function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&(i=r.listeners.indexOf(t))>=0&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++){s[a].onViewSnapshot(r)}o.viewSnap=r}}},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++){i[r].onError(e)}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t,this.queries.forEach(function(e,n){for(var r=0,i=n.listeners;r<i.length;r++){i[r].applyOnlineStateChange(t)}})},t}(),Ou=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=ws.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(Dr(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==Ps.Metadata&&e.push(i)}t=new Bs(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){if(Dr(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==ws.Offline;return this.options.waitForSyncWhenOnline&&n?(Dr(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===ws.Offline},t.prototype.shouldRaiseEvent=function(t){if(t.docChanges.length>0)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){Dr(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=Bs.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),ku=function(){function t(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return t.fromSnapshot=function(e,n){for(var r=zi(),i=zi(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case Ps.Added:r=r.add(s.doc.key);break;case Ps.Removed:i=i.add(s.doc.key)}}return new t(e,r,i)},t}(),_u=function(t){this.key=t},Ru=function(t){this.key=t},Mu=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=zi(),this.mutatedKeys=zi(),this.documentSet=new qs(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new Vs,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof Io?e:null;h&&(Dr(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data.isEqual(h.data)?l!==f&&(r.track({type:Ps.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:Ps.Modified,doc:h}),p=!0,u&&n.query.docComparator(h,u)>0&&(s=!0)):!c&&h?(r.track({type:Ps.Added,doc:h}),p=!0):c&&!h&&(r.track({type:Ps.Removed,doc:c}),p=!0,u&&(s=!0));p&&(h?(a=a.add(h),o=f?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))}),this.query.hasLimit())for(;a.size>this.query.limit;){var c=a.last();a=a.delete(c.key),o=o.delete(c.key),r.track({type:Ps.Removed,doc:c})}return Dr(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;Dr(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case Ps.Added:return 1;case Ps.Modified:case Ps.Metadata:return 2;case Ps.Removed:return 0;default:return Cr("Unknown ChangeType: "+t)}};return n(t)-n(e)}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?xs.Synced:xs.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new Bs(this.query,t.documentSet,i,o,t.mutatedKeys,s===xs.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===ws.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Vs,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Dr(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=zi(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new Ru(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new _u(t))}),n},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=zi();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return Bs.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===xs.Local)},t}();
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lu=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Pu=function(t){this.key=t,this.receivedDocument=!1},xu=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new No(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new Mi(bi.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new es,this.mutationUserCallbacks={},this.limboTargetIdGenerator=uo.forSyncEngine(),this.isPrimary=void 0,this.onlineState=ws.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){Dr(null!==t,"SyncEngine listener cannot be null"),Dr(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(a.d)(this,function(a){switch(a.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=a.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=a.sent(),this.isPrimary&&this.remoteStore.listen(i),a.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(t,e){return Object(a.b)(this,void 0,void 0,function(){var n,r,i,o,s,u,c,h;return Object(a.d)(this,function(a){switch(a.label){case 0:return n=t.query,[4,this.localStore.executeQuery(n)];case 1:return r=a.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return i=a.sent(),o=new Mu(n,i),s=o.computeDocChanges(r),u=js.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&this.onlineState!==ws.Offline),Dr(0===(c=o.applyChanges(s,!0===this.isPrimary,u)).limboChanges.length,"View returned limbo docs before target ack from the server."),Dr(!!c.snapshot,"applyChanges for new view should always return a snapshot"),h=new Lu(n,t.targetId,o),this.queryViewsByQuery.set(n,h),this.queryViewsByTarget[t.targetId]=h,[2,c.snapshot]}})})},t.prototype.synchronizeViewAndComputeSnapshot=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n,r;return Object(a.d)(this,function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t.query)];case 1:return e=i.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return n=i.sent(),r=t.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(t.targetId,r.limboChanges),[2,r]}})})},t.prototype.unlisten=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n=this;return Object(a.d)(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),Dr(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Ea)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){return Object(a.b)(this,void 0,void 0,function(){var n;return Object(a.d)(this,function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}})})},t.prototype.runTransaction=function(t,e){return void 0===e&&(e=5),Object(a.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(a.d)(this,function(a){switch(a.label){case 0:if(Dr(e>=0,"Got negative number of retries for transaction."),n=this.remoteStore.createTransaction(),ys(r=t(n))||!r.catch||!r.then)return[2,Promise.reject(Error("Transaction callback must return a Promise"))];a.label=1;case 1:return a.trys.push([1,4,,5]),[4,r];case 2:return i=a.sent(),[4,n.commit()];case 3:return a.sent(),[2,i];case 4:return o=a.sent(),e>0&&this.isRetryableTransactionError(o)?[2,this.runTransaction(t,e-1)]:[2,Promise.reject(o)];case 5:return[2]}})})},t.prototype.applyRemoteEvent=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n=this;return Object(a.d)(this,function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),Pr(t.targetChanges,function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(Dr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?Dr(r.receivedDocument,"Received change for limbo target document without add."):e.removedDocuments.size>0&&(Dr(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Ea(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===Es.RemoteStore||!this.isPrimary&&e===Es.SharedClientState){var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);Dr(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return Object(a.b)(this,void 0,void 0,function(){var n,r,i,o,s,u,c=this;return Object(a.d)(this,function(a){switch(a.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new Mi(bi.comparator)).insert(r,new Co(r,Ri.forDeletedDoc())),o=zi().add(r),s=new Us(Ri.MIN,{},new qi(ri),i,o),[2,this.applyRemoteEvent(s)]):[3,1];case 1:return Dr(!!(u=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(u.query,!1).then(function(){return c.removeAndCleanupQuery(u)}).catch(Ea)];case 2:a.sent(),this.syncEngineListener.onWatchError(u.query,e),a.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(t,e,n){return Object(a.b)(this,void 0,void 0,function(){var r;return Object(a.d)(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(Sr("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):Cr("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n;return Object(a.d)(this,function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=t.batch.batchId,this.processUserCallback(e,null),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Ea(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.rejectFailedWrite=function(t,e){return Object(a.b)(this,void 0,void 0,function(){var n;return Object(a.d)(this,function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Ea(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new Mi(ri)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Dr(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i instanceof _u)this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i);else if(i instanceof Ru){Sr("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)}else Cr("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Sr("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=Zs.atPath(e.path);this.limboResolutionsByTarget[n]=new Pu(e),this.remoteStore.listen(new sa(r,n,ra.LimboResolution,di.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return Object(a.b)(this,void 0,void 0,function(){var n,r,i,o=this;return Object(a.d)(this,function(a){switch(a.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(a,s){i.push(Promise.resolve().then(function(){var e=s.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(s.query).then(function(t){return s.view.computeDocChanges(t,e)}):e}).then(function(t){var i=e&&e.targetChanges[s.targetId],a=s.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(s.targetId,a.limboChanges),a.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(s.targetId,a.snapshot.fromCache?"not-current":"current"),n.push(a.snapshot);var u=ku.fromSnapshot(s.targetId,a.snapshot);r.push(u)}}))}),[4,Promise.all(i)];case 1:return a.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return a.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){Dr(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n;return Object(a.d)(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?[4,this.localStore.handleUserChange(t)]:[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},t.prototype.applyPrimaryState=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n,r,i,o,s,u,c=this;return Object(a.d)(this,function(a){switch(a.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return a.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=a.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],u=Promise.resolve(),Lr(this.queryViewsByTarget,function(t,e){c.sharedClientState.isLocalQueryTarget(t)?s.push(t):u=u.then(function(){return c.unlisten(e.query)}),c.remoteStore.unlisten(e.targetId)}),[4,u]);case 4:return a.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(s)];case 5:return a.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:a.sent(),a.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var t=this;Lr(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Mi(bi.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return Object(a.b)(this,void 0,void 0,function(){var e,n,r,i,o,s,u,c,h;return Object(a.d)(this,function(a){switch(a.label){case 0:e=[],n=[],r=0,i=t,a.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(u.query,!0)]:[3,5]):[3,11];case 2:return a.sent(),[4,this.localStore.allocateQuery(u.query)];case 3:return s=a.sent(),[4,this.synchronizeViewAndComputeSnapshot(u)];case 4:return(c=a.sent()).snapshot&&n.push(c.snapshot),[3,9];case 5:return Dr(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return Dr(!!(h=a.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(h)];case 7:return s=a.sent(),[4,this.initializeViewAndComputeSnapshot(s,!1)];case 8:a.sent(),a.label=9;case 9:e.push(s),a.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},t.prototype.isRetryableTransactionError=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Rs(e)}return!1},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return Object(a.b)(this,void 0,void 0,function(){var r,i,o,s,u;return Object(a.d)(this,function(a){switch(a.label){case 0:if(this.isPrimary)return Sr("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,11];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return a.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return r=a.sent(),i=Us.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,i)];case 3:return a.sent(),[3,11];case 4:return o=a.sent(),(c=o).code!==Or.DATA_LOSS||c.message!==Oo?[3,6]:(s=[],Lr(this.queryViewsByTarget,function(t){return s.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(s)]);case 5:return a.sent(),[3,7];case 6:throw o;case 7:return[3,8];case 8:return u=this.queryViewsByTarget[t],this.removeAndCleanupQuery(u),[4,this.localStore.releaseQuery(u.query,!0)];case 9:return a.sent(),this.syncEngineListener.onWatchError(u.query,n),[3,11];case 10:Cr("Unexpected target state: "+e),a.label=11;case 11:return[2]}var c})})},t.prototype.applyActiveTargetsChange=function(t,e){return Object(a.b)(this,void 0,void 0,function(){var n,r,i,o,s,u,c,h,l,f=this;return Object(a.d)(this,function(p){switch(p.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,p.label=1;case 1:return n<r.length?(l=r[n],Dr(!this.queryViewsByTarget[l],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(l)]):[3,6];case 2:return Dr(!!(i=p.sent()),"Query data for active target "+l+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=p.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:p.sent(),this.remoteStore.listen(o),p.label=5;case 5:return n++,[3,1];case 6:s=function(t){var e;return Object(a.d)(this,function(n){switch(n.label){case 0:return(e=u.queryViewsByTarget[t])?[4,u.localStore.releaseQuery(e.query,!1).then(function(){f.remoteStore.unlisten(t),f.removeAndCleanupQuery(e)}).catch(Ea)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},u=this,c=0,h=e,p.label=7;case 7:return c<h.length?(l=h[c],[5,s(l)]):[3,10];case 8:p.sent(),p.label=9;case 9:return c++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?zi().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:zi()},t}(),qu=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),Fu="SharedClientState",Vu="firestore_clients",Bu="firestore_mutations",Uu="firestore_targets",ju="firestore_online_state",Qu="firestore_sequence_number",Ku=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,Dr(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),a=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(a=new kr(i.error.code,i.error.message)),o?new t(e,n,i.state,a):(Tr(Fu,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Gu=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,Dr(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new kr(r.error.code,r.error.message)),i?new t(e,r.state,o):(Tr(Fu,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Wu=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Yi(),a=0;i&&a<r.activeTargetIds.length;++a)i=gs(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(Tr(Fu,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),zu=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&n.onlineState in ws&&"string"==typeof n.clientId?new t(n.clientId,ws[n.onlineState]):(Tr(Fu,"Failed to parse online state: "+e),null)},t}(),Hu=function(){function t(){this.activeTargetIds=Yi()}return t.prototype.addQueryTarget=function(t){Dr(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Yu=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new kr(Or.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey=Qu+"_"+r,this.activeClients[this.localClientId]=new Hu,this.clientStateKeyRe=new RegExp("^"+Vu+"_"+a+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Bu+"_"+a+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+Uu+"_"+a+"_(\\d+)$"),this.onlineStateKey=ju+"_"+r,this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return Object(a.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,u,c,h,l,f=this;return Object(a.d)(this,function(a){switch(a.label){case 0:return Dr(!this.started,"WebStorageSharedClientState already started"),Dr(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Dr(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=a.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=Wu.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=Yi();return Pr(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=Gu.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Sr(Fu,"READ",t,e),e},t.prototype.setItem=function(t,e){Sr(Fu,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Sr(Fu,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(Sr(Fu,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void Tr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return Object(a.b)(e,void 0,void 0,function(){var e,n,r,i,o,s;return Object(a.d)(this,function(a){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(Dr(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(s=function(t){var e=di.INVALID;if(null!=t)try{var n=JSON.parse(t);Dr("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Tr(Fu,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==di.INVALID&&this.sequenceNumberHandler(s));return[2]})})})}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new Ku(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:ws[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},t.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new Gu(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.toWebStorageClientStateKey=function(t){return Dr(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),Vu+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageQueryTargetMetadataKey=function(t){return Uu+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageMutationBatchKey=function(t){var e=Bu+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Dr(null!==n,"Cannot parse client state key '"+t+"'"),Wu.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Dr(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ku.fromWebStorageEntry(new qu(i),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Dr(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Gu.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return zu.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(e){return t.user.uid!==this.currentUser.uid?(Sr(Fu,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],s=[];return i.forEach(function(t){return Object(a.b)(n,void 0,void 0,function(){return Object(a.d)(this,function(e){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return Object(a.b)(n,void 0,void 0,function(){return Object(a.d)(this,function(e){return i.has(t)||s.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,s)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}();var Xu=function(){function t(){this.localState=new Hu,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new Hu,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),Ju=function(){function t(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}return t.prototype.lruParams=function(){return fa.withCacheSize(this.cacheSizeBytes)},t}(),$u=function(){},Zu=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=ni.newId()}return t.prototype.start=function(t){var e=this;this.verifyNotShutdown();var n=new wi,r=new wi,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof Ju?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof kr?t.code===Or.FAILED_PRECONDITION||t.code===Or.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)},t.prototype.verifyNotShutdown=function(){if(this.asyncQueue.isShuttingDown)throw new kr(Or.FAILED_PRECONDITION,"The client has already been shutdown.")},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=wa.buildStoragePrefix(this.databaseInfo),i=new Du(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return Object(a.b)(n,void 0,void 0,function(){var n,o;return Object(a.d)(this,function(a){switch(a.label){case 0:if(e.synchronizeTabs&&!Yu.isAvailable(this.platform))throw new kr(Or.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return o=e.lruParams(),e.synchronizeTabs?(this.sharedClientState=new Yu(this.asyncQueue,this.platform,r,this.clientId,t),[4,wa.createMultiClientIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return n=a.sent(),[3,4];case 2:return this.sharedClientState=new Xu,[4,wa.createIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o)];case 3:n=a.sent(),a.label=4;case 4:return this.persistence=n,[2,n.referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=us.createEagerPersistence(this.clientId),this.sharedClientState=new Xu,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return Sr("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(r){return Object(a.b)(n,void 0,void 0,function(){var n,i,o,s,u,c=this;return Object(a.d)(this,function(h){switch(h.label){case 0:return this.localStore=new rs(this.persistence,t),e&&(this.lruScheduler=new pa(e,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),i=this.platform.newSerializer(this.databaseInfo.databaseId),o=new As(this.asyncQueue,r,this.credentials,i),s=function(t){return c.syncEngine.applyOnlineStateChange(t,Es.RemoteStore)},u=function(t){return c.syncEngine.applyOnlineStateChange(t,Es.SharedClientState)},this.remoteStore=new Js(this.localStore,o,this.asyncQueue,s,n),this.syncEngine=new xu(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=u,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new Au(this.syncEngine),[4,this.sharedClientState.start()];case 1:return h.sent(),[4,this.remoteStore.start()];case 2:return h.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return Object(a.b)(c,void 0,void 0,function(){return Object(a.d)(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 3:return h.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return Object(a.b)(c,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return[4,this.shutdown()];case 1:return t.sent(),[2]}})})})];case 4:return h.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Sr("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return Object(a.b)(t,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new Ou(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.verifyNotShutdown(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Io)return t;if(t instanceof Co)return null;throw new kr(Or.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=zi(),r=new Mu(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},t.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new wi;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},Object.defineProperty(t.prototype,"clientShutdown",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.transaction=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return Object(a.b)(e,void 0,void 0,function(){return Object(a.d)(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),tc=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),ec=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+ei(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Ur("FieldPath","string",n,t[n]),0===t[n].length)throw new kr(Or.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new vi(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(vi.keyField().canonicalString()),t}(),nc=new RegExp("[~\\*/\\[\\]]");
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var rc=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},ic=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){Dr(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(qu.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){Dr(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),oc=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=qu.UNAUTHENTICATED,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var t=this;Dr(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new kr(Or.ABORTED,"getToken aborted due to token change.");return n?(Dr("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new rc(n.accessToken,t.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){Dr(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){Dr(null!=this.tokenListener,"removeChangeListener() called twice"),Dr(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Dr(null===t||"string"==typeof t,"Received invalid UID: "+t),new qu(t)},t}(),ac=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=qu.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),sc=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new ac(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(qu.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function uc(t){if(!t)return new ic;switch(t.type){case"gapi":var e=t.client;return Dr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new sc(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new kr(Or.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,["next","error","complete"])}var hc,lc=function(){function t(t){this._methodName=t}return t.delete=function(){return qr("FieldValue.delete",arguments),fc.instance},t.serverTimestamp=function(){return qr("FieldValue.serverTimestamp",arguments),pc.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Vr("FieldValue.arrayUnion",arguments,1),new dc(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Vr("FieldValue.arrayRemove",arguments,1),new mc(t)},t.increment=function(t){return Ur("FieldValue.increment","number",1,t),Fr("FieldValue.increment",arguments,1),new yc(t)},t.prototype.isEqual=function(t){return this===t},t}(),fc=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return Object(a.c)(e,t),e.instance=new e,e}(lc),pc=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return Object(a.c)(e,t),e.instance=new e,e}(lc),dc=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return Object(a.c)(e,t),e}(lc),mc=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return Object(a.c)(e,t),e}(lc),yc=function(t){function e(e){var n=t.call(this,"FieldValue.increment")||this;return n._operand=e,n}return Object(a.c)(e,t),e}(lc),gc=_r(lc,"Use FieldValue.<field>() instead."),vc=/^__.*__$/,bc=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Ja(t,this.data,this.fieldMask,e)):n.push(new Xa(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new $a(t,this.fieldTransforms)),n},t}(),wc=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new Ja(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new $a(t,this.fieldTransforms)),n},t}();function Ec(t){switch(t){case hc.Set:case hc.MergeSet:case hc.Update:return!0;case hc.Argument:return!1;default:throw Cr("Unexpected case for UserDataSource: "+t)}}!function(t){t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument"}(hc||(hc={}));var Sc=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new kr(Or.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(Ec(this.dataSource)&&vc.test(t))throw this.createError("Document fields cannot begin and end with __")},t}(),Tc=function(t,e){this.databaseId=t,this.key=e},Ic=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new Sc(hc.Set,t,vi.EMPTY_PATH);Dc("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new bc(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new Sc(hc.MergeSet,t,vi.EMPTY_PATH);Dc("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new qi(vi.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof ec)l=h._internalPath;else{if("string"!=typeof h)throw Cr("Expected stringOrFieldPath to be a string or a FieldPath");l=Ac(t,h)}if(!r.contains(l))throw new kr(Or.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=Ga.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=Ga.fromArray(r.fieldMask),o=r.fieldTransforms;return new bc(a,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new Sc(hc.Update,t,vi.EMPTY_PATH);Dc("Data must be an object, but it was:",r,e);var i=new qi(vi.comparator),o=Qa.EMPTY;Pr(e,function(e,a){var s=Ac(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof fc)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}});var a=Ga.fromSet(i);return new wc(o,a,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Sc(hc.Update,t,vi.EMPTY_PATH),o=[Nc(t,e)],a=[n];if(r.length%2!=0)throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Nc(t,r[s])),a.push(r[s+1]);var u=new qi(vi.comparator),c=Qa.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof fc)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=Ga.fromSet(u);return new wc(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new Sc(hc.Argument,t,vi.EMPTY_PATH),r=this.parseData(e,n);return Dr(null!=r,"Parsed data should not be null."),Dr(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=Oc(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(Cc(t=this.runPreConverter(t,e)))return Dc("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof lc)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new Mi(ri);return xr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pr(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new Qa(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=ka.INSTANCE),n.push(s),r++}return new Ka(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!Ec(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof fc){if(e.dataSource!==hc.MergeSet)throw e.dataSource===hc.Update?(Dr(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof pc)e.fieldTransforms.push(new Wa(e.path,pu.instance));else if(t instanceof dc){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new du(n);e.fieldTransforms.push(new Wa(e.path,r))}else if(t instanceof mc){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new mu(n);e.fieldTransforms.push(new Wa(e.path,i))}else if(t instanceof yc){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new yu(o);e.fieldTransforms.push(new Wa(e.path,a))}else Cr("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return ka.INSTANCE;if("number"==typeof t)return gs(t)?new Pa(t):new xa(t);if("boolean"==typeof t)return _a.of(t);if("string"==typeof t)return new qa(t);if(t instanceof Date)return new Fa(_i.fromDate(t));if(t instanceof _i)return new Fa(new _i(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof $s)return new ja(t);if(t instanceof ci)return new Ba(t);if(t instanceof Tc)return new Ua(t.databaseId,t.key);throw e.createError("Unsupported field value: "+Xr(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new Sc(hc.Argument,t,vi.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},t}();function Cc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof _i||t instanceof $s||t instanceof ci||t instanceof Tc||t instanceof lc)}function Dc(t,e,n){if(!Cc(n)||!Yr(n)){var r=Xr(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Nc(t,e){if(e instanceof ec)return e._internalPath;if("string"==typeof e)return Ac(t,e);throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Ac(t,e){try{return function(t){if(t.search(nc)>=0)throw new kr(Or.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(ec.bind.apply(ec,[void 0].concat(t.split("."))))}catch(e){throw new kr(Or.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=Oc(e);throw new kr(Or.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Oc(t){return t instanceof Error?t.message:t.toString()}
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kc="firestore.googleapis.com",_c=!0,Rc=!0,Mc=!1,Lc=fa.COLLECTION_DISABLED,Pc=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new kr(Or.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=kc,this.ssl=_c}else Qr("settings","non-empty string","host",t.host),this.host=t.host,Kr("settings","boolean","ssl",t.ssl),this.ssl=Mr(t.ssl,_c);if($r("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Kr("settings","object","credentials",t.credentials),this.credentials=t.credentials,Kr("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Tr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Tr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Mr(t.timestampsInSnapshots,Rc),Kr("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=fa.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==Lc&&t.cacheSizeBytes<fa.MINIMUM_CACHE_SIZE_BYTES)throw new kr(Or.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+fa.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}Kr("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0===t.experimentalForceLongPolling?Mc:t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),xc=function(){function t(e){var n=this;if(this._firebaseApp=null,this._queue=new Si,this.INTERNAL={delete:function(){return Object(a.b)(n,void 0,void 0,function(){return Object(a.d)(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),[2]}})})}},"object"==typeof e.options){var r=e;this._firebaseApp=r,this._databaseId=t.databaseIdFromApp(r),this._persistenceKey=r.name,this._credentials=new oc(r)}else{var i=e;if(!i.projectId)throw new kr(Or.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new pi(i.projectId,i.database),this._persistenceKey="[DEFAULT]",this._credentials=new ic}this._settings=new Pc({}),this._dataConverter=this.createDataConverter(this._databaseId)}return t.prototype.settings=function(t){if(Fr("Firestore.settings",arguments,1),Ur("Firestore.settings","object",1,t),Rr(t,"persistence"))throw new kr(Or.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Pc(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new kr(Or.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._settings=e,void 0!==e.credentials&&(this._credentials=uc(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new kr(Or.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Tr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Mr(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new Ju(this._settings.cacheSizeBytes,e))},t.prototype.clearPersistence=function(){var t=this,e=wa.buildStoragePrefix(this.makeDatabaseInfo()),n=new wi;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return Object(a.b)(t,void 0,void 0,function(){var t;return Object(a.d)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientShutdown)throw new kr(Or.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,wa.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}})})}),n.promise},t.prototype._shutdown=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"_isShutdown",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientShutdown},enumerable:!0,configurable:!0}),t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new $u),this._firestoreClient},t.prototype.makeDatabaseInfo=function(){return new li(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},t.prototype.configureClient=function(t){Dr(!!this._settings.host,"FirestoreSettings.host is not set"),Dr(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new Zu(Nr.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},t.prototype.createDataConverter=function(t){return new Ic(function(e){if(e instanceof Vc){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new kr(Or.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new Tc(t,e._key)}return e})},t.databaseIdFromApp=function(t){var e=t.options;if(!Rr(e,"projectId"))throw new kr(Or.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new kr(Or.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new pi(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._firebaseApp)throw new kr(Or.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return Fr("Firestore.collection",arguments,1),Ur("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new Gc(yi.fromString(t),this)},t.prototype.doc=function(t){return Fr("Firestore.doc",arguments,1),Ur("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),Vc.forPath(yi.fromString(t),this)},t.prototype.collectionGroup=function(t){if(Fr("Firestore.collectionGroup",arguments,1),Ur("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new kr(Or.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new Qc(new Zs(yi.EMPTY_PATH,t),this)},t.prototype.runTransaction=function(t){var e=this;return Fr("Firestore.runTransaction",arguments,1),Ur("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new qc(e,n))})},t.prototype.batch=function(){return this.ensureClientConfigured(),new Fc(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(wr()){case lr.DEBUG:return"debug";case lr.ERROR:return"error";case lr.SILENT:return"silent";default:return Cr("Unknown log level: "+wr())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(Fr("Firestore.setLogLevel",arguments,1),Ur("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Er(lr.DEBUG);break;case"error":Er(lr.ERROR);break;case"silent":Er(lr.SILENT);break;default:throw new kr(Or.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},t}(),qc=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;Fr("Transaction.get",arguments,1);var n=Yc("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Cr("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof Co)return new Uc(e._firestore,n._key,null,!1,!1);if(r instanceof Io)return new Uc(e._firestore,n._key,r,!1,!1);throw Cr("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},t.prototype.set=function(t,e,n){Br("Transaction.set",arguments,2,3);var r=Yc("Transaction.set",t,this._firestore),i=(n=Wc("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return"string"==typeof e||e instanceof ec?(Vr("Transaction.update",arguments,3),r=Yc("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Fr("Transaction.update",arguments,2),r=Yc("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){Fr("Transaction.delete",arguments,1);var e=Yc("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Fc=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){Br("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=Yc("WriteBatch.set",t,this._firestore),i=(n=Wc("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,Ha.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),"string"==typeof e||e instanceof ec?(Vr("WriteBatch.update",arguments,3),r=Yc("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Fr("WriteBatch.update",arguments,2),r=Yc("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Ha.exists(!0))),this},t.prototype.delete=function(t){Fr("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=Yc("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Za(e._key,Ha.NONE)),this},t.prototype.commit=function(){return Object(a.b)(this,void 0,void 0,function(){return Object(a.d)(this,function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new kr(Or.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Vc=function(){function t(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n){if(e.length%2!=0)throw new kr(Or.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new bi(e),n)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Gc(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(Fr("DocumentReference.collection",arguments,1),Ur("DocumentReference.collection","non-empty string",1,t),!t)throw new kr(Or.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=yi.fromString(t);return new Gc(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)},t.prototype.set=function(t,e){Br("DocumentReference.set",arguments,1,2);var n=(e=Wc("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,Ha.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof ec?(Vr("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Fr("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Ha.exists(!0)))},t.prototype.delete=function(){return Fr("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Za(this._key,Ha.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Br("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||cc(t[i])||($r("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Kr("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return cc(t[i])?n=t[i]:(Ur("DocumentReference.onSnapshot","function",i,t[i]),jr("DocumentReference.onSnapshot","function",i+1,t[i+1]),jr("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new tc({next:function(t){if(e.next){Dr(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new Uc(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(Zs.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return Br("DocumentReference.get",arguments,0,1),Hc("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new Uc(e.firestore,e._key,t,!0,t instanceof Io&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new kr(Or.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new kr(Or.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t}(),Bc=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Uc=function(){function t(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return t.prototype.data=function(t){return Br("DocumentSnapshot.data",arguments,0,1),t=zc("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,Aa.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},t.prototype.get=function(t,e){if(Br("DocumentSnapshot.get",arguments,1,2),e=zc("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(Nc("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,Aa.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Vc(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Bc(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))},t.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertValue=function(t,e){if(t instanceof Qa)return this.convertObject(t,e);if(t instanceof Ka)return this.convertArray(t,e);if(t instanceof Ua){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Tr("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Vc(n,this._firestore)}return t.value(e)},t.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},t}(),jc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(a.c)(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return Dr("object"==typeof n,"Document in a QueryDocumentSnapshot should exist"),n},e}(Uc),Qc=function(){function t(t,e){this._query=t,this.firestore=e}return t.prototype.where=function(e,n,r){if(Fr("Query.where",arguments,3),Jr("Query.where",3,r),"in"!==n&&"array-contains-any"!==n){var i=["<","<=","==",">=",">","array-contains"];zr("Query.where",i,2,n)}var o,a=Nc("Query.where",e),s=eu.fromString(n);if(a.isKeyField()){if(s===eu.ARRAY_CONTAINS||s===eu.ARRAY_CONTAINS_ANY)throw new kr(Or.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+s.toString()+"' queries on FieldPath.documentId().");if(s===eu.IN){this.validateDisjunctiveFilterElements(r,s);for(var u=[],c=0,h=r;c<h.length;c++){var l=h[c];u.push(this.parseDocumentIdValue(l))}o=new Ka(u)}else o=this.parseDocumentIdValue(r)}else s!==eu.IN&&s!==eu.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(r,s),o=this.firestore._dataConverter.parseQueryValue("Query.where",r);var f=nu.create(a,s,o);return this.validateNewFilter(f),new t(this._query.addFilter(f),this.firestore)},t.prototype.orderBy=function(e,n){var r;if(Br("Query.orderBy",arguments,1,2),jr("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=uu.ASCENDING;else{if("desc"!==n)throw new kr(Or.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=uu.DESCENDING}if(null!==this._query.startAt)throw new kr(Or.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new kr(Or.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=Nc("Query.orderBy",e),o=new hu(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore)},t.prototype.limit=function(e){if(Fr("Query.limit",arguments,1),Ur("Query.limit","number",1,e),e<=0)throw new kr(Or.INVALID_ARGUMENT,"Invalid Query. Query limit ("+e+") is invalid. Limit must be positive.");return new t(this._query.withLimit(e),this.firestore)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Vr("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Vr("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Vr("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Vr("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(Jr(t,1,e),e instanceof Uc){if(n.length>0)throw new kr(Or.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new kr(Or.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Ua(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Va)throw new kr(Or.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new kr(Or.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new cu(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new kr(Or.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new kr(Or.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new kr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(yi.fromString(a));if(!bi.isDocumentKey(s))throw new kr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new bi(s);i.push(new Ua(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new cu(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Br("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||cc(t[i])||($r("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Kr("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),cc(t[i])?n=t[i]:(Ur("Query.onSnapshot","function",i,t[i]),jr("Query.onSnapshot","function",i+1,t[i+1]),jr("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new tc({next:function(t){e.next&&e.next(new Kc(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},t.prototype.get=function(t){var e=this;return Br("Query.get",arguments,0,1),Hc("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new Kc(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new kr(Or.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new kr(Or.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new kr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(yi.fromString(t));if(!bi.isDocumentKey(e))throw new kr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Ua(this.firestore._databaseId,new bi(e))}if(t instanceof Vc){var n=t;return new Ua(this.firestore._databaseId,n._key)}throw new kr(Or.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Xr(t)+".")},t.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new kr(Or.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new kr(Or.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new kr(Or.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter(function(t){return Number.isNaN(t)}).length>0)throw new kr(Or.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},t.prototype.validateNewFilter=function(t){if(t instanceof nu){var e=[eu.ARRAY_CONTAINS,eu.ARRAY_CONTAINS_ANY],n=[eu.IN,eu.ARRAY_CONTAINS_ANY],r=e.indexOf(t.op)>=0,i=n.indexOf(t.op)>=0;if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new kr(Or.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new kr(Or.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new kr(Or.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new kr(Or.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),Kc=function(){function t(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new Bc(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;Br("QuerySnapshot.forEach",arguments,1,2),Ur("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(t.prototype,"query",{get:function(){return new Qc(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&($r("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Kr("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new kr(Or.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new jc(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return Dr(e.type===Ps.Added,"Invalid event type for first snapshot"),Dr(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==Ps.Metadata}).map(function(e){var r=new jc(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,a=-1;return e.type!==Ps.Added&&(Dr((i=o.indexOf(e.doc.key))>=0,"Index for document not found"),o=o.delete(e.doc.key)),e.type!==Ps.Removed&&(a=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:Xc(e.type),doc:r,oldIndex:i,newIndex:a}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Zr("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)},t.prototype.convertToDocumentImpl=function(t){return new jc(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},t}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(Kc.prototype.docChanges,t,{get:function(){return function(){throw new kr(Or.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var Gc=function(t){function e(e,n){var r=t.call(this,Zs.atPath(e),n)||this;if(e.length%2!=1)throw new kr(Or.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return r}return Object(a.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new Vc(new bi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(Br("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=ni.newId()),Ur("CollectionReference.doc","non-empty string",1,t),""===t)throw new kr(Or.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=yi.fromString(t);return Vc.forPath(this._query.path.child(e),this.firestore)},e.prototype.add=function(t){Fr("CollectionReference.add",arguments,1),Ur("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},e}(Qc);function Wc(t,e){if(void 0===e)return{merge:!1};if($r(t,e,["merge","mergeFields"]),Kr(t,"boolean","merge",e.merge),Gr(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof ec}),void 0!==e.mergeFields&&void 0!==e.merge)throw new kr(Or.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function zc(t,e){return void 0===e?{}:($r(t,e,["serverTimestamps"]),Wr(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Hc(t,e){jr(t,"object",1,e),e&&($r(t,e,["source"]),Wr(t,0,"source",e.source,["default","server","cache"]))}function Yc(t,e,n){if(e instanceof Vc){if(e.firestore!==n)throw new kr(Or.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Zr(t,"DocumentReference",1,e)}function Xc(t){switch(t){case Ps.Added:return"added";case Ps.Modified:case Ps.Metadata:return"modified";case Ps.Removed:return"removed";default:return Cr("Unknown change type: "+t)}}var Jc=_r(xc,"Use firebase.firestore() instead."),$c=_r(qc,"Use firebase.firestore().runTransaction() instead."),Zc=_r(Fc,"Use firebase.firestore().batch() instead."),th=_r(Vc,"Use firebase.firestore().doc() instead."),eh=_r(Uc),nh=_r(jc),rh=_r(Qc),ih=_r(Kc),oh=_r(Gc,"Use firebase.firestore().collection() instead."),ah={Firestore:Jc,GeoPoint:$s,Timestamp:_i,Blob:hi,Transaction:$c,WriteBatch:Zc,DocumentReference:th,DocumentSnapshot:eh,Query:rh,QueryDocumentSnapshot:nh,QuerySnapshot:ih,CollectionReference:oh,FieldPath:ec,FieldValue:gc,setLogLevel:xc.setLogLevel,CACHE_SIZE_UNLIMITED:Lc};function sh(t){t.INTERNAL.registerService("firestore",function(t){return new xc(t)},function(t){Dr(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(ah))}
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var uh=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.shutdown=function(){},t}(),ch=function(){function t(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}return t.prototype.addCallback=function(t){this.callbacks.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},t.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},t.prototype.onNetworkAvailable=function(){Sr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(0)}},t.prototype.onNetworkUnavailable=function(){Sr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(1)}},t.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),hh=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){Dr(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){Dr(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){Dr(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){Dr(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){Dr(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){Dr(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),lh="Connection",fh={BatchGetDocuments:"batchGet",Commit:"commit"},ph="gl-js/ fire/"+vr,dh=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=ph},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,a){var s=new gr;s.listenOnce(mr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case dr.NO_ERROR:var e=s.getResponseJson();Sr(lh,"XHR received:",JSON.stringify(e)),o(e);break;case dr.TIMEOUT:Sr(lh,'RPC "'+t+'" timed out'),a(new kr(Or.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:var n=s.getStatus();if(Sr(lh,'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var i=(u=r.status,c=u.toLowerCase().replace("_","-"),Object.values(Or).indexOf(c)>=0?c:Or.UNKNOWN);a(new kr(i,r.message))}else a(new kr(Or.UNKNOWN,"Server responded with status "+s.getStatus()))}else Sr(lh,'RPC "'+t+'" failed'),a(new kr(Or.UNAVAILABLE,"Connection failed."));break;default:Cr('RPC "'+t+'" failed with unanticipated webchannel error '+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{Sr(lh,'RPC "'+t+'" completed.')}var u,c});var u=JSON.stringify(e);Sr(lh,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),s.send(i,"POST",u,c,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=pr(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Object(s.i)()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");Sr(lh,"Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),u=!1,c=!1,h=new hh({sendFn:function(t){c?Sr(lh,"Not sending because WebChannel is closed:",t):(u||(Sr(lh,"Opening WebChannel transport."),a.open(),u=!0),Sr(lh,"WebChannel sending:",t),a.send(t))},closeFn:function(){return a.close()}}),l=function(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(yr.EventType.OPEN,function(){c||Sr(lh,"WebChannel transport opened.")}),l(yr.EventType.CLOSE,function(){c||(c=!0,Sr(lh,"WebChannel transport closed"),h.callOnClose())}),l(yr.EventType.ERROR,function(t){c||(c=!0,Sr(lh,"WebChannel transport errored:",t),h.callOnClose(new kr(Or.UNAVAILABLE,"The operation could not be completed")))}),l(yr.EventType.MESSAGE,function(t){if(!c){var e=t.data[0];Dr(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){Sr(lh,"WebChannel received error:",r);var i=r.status,o=function(t){var e=ks[t];if(void 0!==e)return Ms(e)}(i),s=r.message;void 0===o&&(o=Or.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new kr(o,s)),a.close()}else Sr(lh,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},t.prototype.makeUrl=function(t){var e=fh[t];Dr(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),mh=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new dh(t))},t.prototype.newConnectivityMonitor=function(){return ch.isAvailable()?new ch:new uh},t.prototype.newSerializer=function(t){return new Du(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Nr.setPlatform(new mh),sh(i.a)},4:function(t,e,n){"use strict";var r,i=n(0),o=n(1),a=n(2),s=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["duplicate-service"]="Firebase service named '{$appName}' already registered",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r),u=new o.a("app","Firebase",s),c="[DEFAULT]",h=[],l=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Object(o.d)(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){h.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){h=h.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);for(var e=[],n=0,r=Object.keys(t.services_);n<r.length;n++)for(var i=r[n],o=0,a=Object.keys(t.services_[i]);o<a.length;o++){var s=a[o];e.push(t.services_[i][s])}return Promise.all(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=c),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==c?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=c),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;Object(o.e)(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(h.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),h=[])},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw u.create("app-deleted",{appName:this.name_})},t}();l.prototype.name&&l.prototype.options||l.prototype.delete||console.log("dc");var f="6.3.5";
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var p=new a.b("@firebase/app");if(Object(o.g)()&&void 0!==self.firebase){p.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var d=self.firebase.SDK_VERSION;d&&d.indexOf("LITE")>=0&&p.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var m=
/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function t(){var e=function(t){var e={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){void 0===r&&(r={}),"object"==typeof r&&null!==r||(r={name:r});var a=r;void 0===a.name&&(a.name=c);var s=a.name;if("string"!=typeof s||!s)throw u.create("bad-app-name",{appName:String(s)});if(Object(o.b)(e,s))throw u.create("duplicate-app",{appName:s});var l=new t(n,a,i);return e[s]=l,h(l,"create"),l},app:a,apps:null,SDK_VERSION:f,INTERNAL:{registerService:function(e,c,h,l,f){if(void 0===f&&(f=!1),n[e])throw u.create("duplicate-service",{appName:e});function p(t){if(void 0===t&&(t=a()),"function"!=typeof t[e])throw u.create("invalid-app-argument",{appName:e});return t[e]()}return n[e]=c,l&&(r[e]=l,s().forEach(function(t){l("create",t)})),void 0!==h&&Object(o.e)(p,h),i[e]=p,t.prototype[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=this._getService.bind(this,e);return r.apply(this,f?t:[])},p},removeApp:function(t){h(e[t],"delete"),delete e[t]},factories:n,useAsService:l}};function a(t){if(t=t||c,!Object(o.b)(e,t))throw u.create("no-app",{appName:t});return e[t]}function s(){return Object.keys(e).map(function(t){return e[t]})}function h(t,e){for(var i=0,o=Object.keys(n);i<o.length;i++){var a=l(0,o[i]);if(null===a)return;r[a]&&r[a](e,t)}}function l(t,e){return"serverAuth"===e?null:e}return i.default=i,Object.defineProperty(i,"apps",{get:s}),a.App=t,i}(l);return e.INTERNAL=Object(i.a)({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){Object(o.e)(e,t)},createSubscribe:o.c,ErrorFactory:o.a,deepExtend:o.e}),e}(),y=m.initializeApp;m.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Object(o.h)()&&p.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),y.apply(void 0,t)};var g=m;e.a=g}}));